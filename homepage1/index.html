<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–®å­—ç‹ - æ ¸å¿ƒç³»çµ±</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        html, body {
            overflow-x: hidden;
            width: 100%;
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }

        /* å–®å­—å¡é«˜åº¦å›ºå®š */
        .word-card {
            perspective: 1000px;
            cursor: pointer;
            height: 220px; /* å›ºå®šæ¯å¼µå–®å­—å¡é«˜åº¦ */
        }

        .word-card-inner {
            display: grid;
            grid-template-areas: "card-content";
            position: relative;
            width: 100%;
            height: 100%; /* å…§éƒ¨å¡«æ»¿æ•´å€‹å¡ç‰‡é«˜åº¦ */
            transition: transform 0.35s ease-out; /* ç¿»è½‰å‹•ç•«ç¸®çŸ­ã€è®Šå°ä¸€é» */
            transform-style: preserve-3d;
            transform-origin: center;
        }

        .word-card.is-flipped .word-card-inner {
            transform: rotateY(180deg);
        }

        .word-card-front,
        .word-card-back {
            grid-area: card-content;
            width: 100%;
            height: 100%; /* å‰å¾Œé¢éƒ½è·Ÿå¡ç‰‡ä¸€æ¨£é«˜ */
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
        }

        .word-card-front {
            justify-content: center;
        }

        .word-card-back {
            transform: rotateY(180deg);
            background-color: #f3f4f6;
            justify-content: flex-start;      /* å¾æœ€ä¸Šæ–¹é–‹å§‹æ’ç‰ˆ */
            align-items: stretch;             /* å…§å®¹æ’æ»¿å¯¬åº¦ */
            overflow-y: auto;                 /* è¶…å‡ºæ™‚ç”¨æ²å‹•æŸ¥çœ‹å…¶ä»–ç¿»è­¯ */
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            text-align: center;               /* ä¸­æ–‡æ°´å¹³ç½®ä¸­ */
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.2s ease-in-out 0s 2; }

        @keyframes highlight {
            0% { border-color: #f59e0b; box-shadow: 0 0 15px #f59e0b; transform: scale(1.05); }
            50% { border-color: #f59e0b; box-shadow: 0 0 25px #f59e0b; transform: scale(1.1); }
            100% { border-color: #e5eeb; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); transform: scale(1); }
        }
        .highlight-card .word-card-front {
            animation: highlight 1.5s ease-in-out;
            border-width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        @keyframes woggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(1deg); }
            75% { transform: rotate(-1deg); }
            100% { transform: rotate(0deg); }
        }
        .editing-mode .folder-card {
            animation: woggle 0.3s infinite;
            border: 2px solid #ef4444;
        }

        .choice-btn {
            transition: all 0.2s;
        }
        .choice-btn:active {
            transform: scale(0.98);
        }
        .choice-correct {
            background-color: #22c55e !important;
            color: white !important;
            border-color: #22c55e !important;
        }
        .choice-wrong {
            background-color: #ef4444 !important;
            color: white !important;
            border-color: #ef4444 !important;
            opacity: 0.6;
        }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^19.2.4",
        "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
        "react/": "https://esm.sh/react@^19.2.4/"
      }
    }
    </script>
</head>
<body class="bg-gray-50 min-h-screen font-sans pb-24">

<!-- èƒŒæ™¯éŸ³æ¨‚ audio å…ƒç´  -->
<audio id="bgm-audio" class="hidden" loop></audio>

<!-- é è¨­å­—åº« -->
<script>
    const defaultWordDatabase = [
    {"english": "penetrate", "meaning": "ç©¿é€ï¼›æ»²é€ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "penetrating", "meaning": "å…·ç©¿é€åŠ›çš„ï¼›éŸ¿äº®çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "penetration", "meaning": "æ»²é€ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "exclaim", "meaning": "å¤§å«ï¼›é©šå‘¼ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "exclamation", "meaning": "å¤§å«ï¼›é©šå‘¼ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "contemplate", "meaning": "æ²‰æ€ï¼›å‡è¦– (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "contemplation", "meaning": "æ³¨è¦–ï¼›æ²‰æ€ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "naive", "meaning": "å¤©çœŸçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "exceptional", "meaning": "ç•°å¸¸çš„ï¼›éå‡¡çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "curriculum", "meaning": "èª²ç¨‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "supervise", "meaning": "ç›£ç£ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "supervisor", "meaning": "ç›£ç£äºº (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "supervision", "meaning": "ç›£ç£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "steer", "meaning": "é§•é§› (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "confession", "meaning": "èªç½ªï¼›æ‡ºæ‚” (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "workshop", "meaning": "å·¥ä½œåŠï¼›ç ”ç¿’ç‡Ÿ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "behalf", "meaning": "ä»£è¡¨ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "sole", "meaning": "å”¯ä¸€çš„ (a.) / è…³åº•ï¼›é‹åº• (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "minimal", "meaning": "æ¥µå°‘çš„ï¼›æœ€ä½é™åº¦çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "minimize", "meaning": "ä½¿æœ€å°åŒ– (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "miniature", "meaning": "è¿·ä½ çš„ (a.) / å°è¤‡è£½å“ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "optimism", "meaning": "æ¨‚è§€ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "optimistic", "meaning": "æ¨‚è§€çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "optimist", "meaning": "æ¨‚è§€ä¸»ç¾©è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "scan", "meaning": "æƒæï¼›ç€è¦½ (v.) / æƒæï¼›ç€è¦½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "commodity", "meaning": "å•†å“ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "yield", "meaning": "ç”¢ç”Ÿï¼›å±ˆæœ (v.) / ç”¢é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "caution", "meaning": "è¬¹æ… (n.) / å‘Šèª¡ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "cautious", "meaning": "è¬¹æ…çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "precaution", "meaning": "é é˜²æªæ–½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "verbal", "meaning": "è¨€èªä¸Šçš„ (a.) / æº–å‹•è© (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "peasant", "meaning": "å°å‹è‡ªè€•è¾² (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "contempt", "meaning": "è¼•è¦– (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "conceal", "meaning": "éš±è— (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "concealment", "meaning": "éš±è— (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "tempt", "meaning": "èª˜æƒ‘ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "tempting", "meaning": "èª˜äººçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "temptation", "meaning": "èª˜æƒ‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "infinite", "meaning": "ç„¡é™çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "infinity", "meaning": "ç„¡é™ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "sober", "meaning": "æ¸…é†’çš„ï¼›åš´è‚…çš„ (a.) / ä½¿æ¸…é†’ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "ridiculous", "meaning": "è’è¬¬çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "ridicule", "meaning": "å˜²ç¬‘ (v.) /å˜²ç¬‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "beloved", "meaning": "æ‘¯æ„›çš„ (a.) / æ·±æ„›çš„äºº (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "continental", "meaning": "å¤§é™¸çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "sturdy", "meaning": "å¼·å¥çš„ï¼›ç‰¢å›ºçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "structural", "meaning": "çµæ§‹ä¸Šçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "startle", "meaning": "é©šåš‡ (v.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "startling", "meaning": "é©šäººçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "preference", "meaning": "åå¥½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "preferable", "meaning": "æ›´å¥½çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "haul", "meaning": "æ‹–æ›³ (v.) / æ¼ç²é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "bulk", "meaning": "å¤§é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "via", "meaning": "ç¶“ç”± (prep.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "patron", "meaning": "è´ŠåŠ©äººï¼›è€ä¸»é¡§ (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "compromise", "meaning": "å¦¥å”ï¼›æåŠ (v.) / å¦¥å” (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "absurd", "meaning": "è’è¬¬çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "absurdity", "meaning": "è’å” (n.)", "tags": ["æ™Ÿæ™¯Lv5U6"]},
    {"english": "odds", "meaning": "å¯èƒ½æ€§ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "apt", "meaning": "è²¼åˆ‡çš„ï¼›æ°ç•¶çš„ï¼›æ˜“æ–¼...çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "aptitude", "meaning": "è³‡è³ªï¼›å‚¾å‘ï¼›æ€§å‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "blast", "meaning": "å¼·é¢¨ï¼›çˆ†éœ‡ (n.) / çˆ†ç‚¸ (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "doorway", "meaning": "é–€å£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "driveway", "meaning": "ç§äººè»Šé“ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "slap", "meaning": "ä¸€å·´æŒï¼›ä¾®è¾± (n.) / æ§å·´æŒ (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "commute", "meaning": "é€šå‹¤ (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "commuter", "meaning": "é€šå‹¤è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "indulge", "meaning": "æ”¾ä»» (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "consent", "meaning": "åŒæ„ (n.) / åŒæ„ (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "consensus", "meaning": "å…±è­˜ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "hostile", "meaning": "æœ‰æ•µæ„çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "hostility", "meaning": "æ•µæ„ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "quest", "meaning": "è¿½å°‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "ego", "meaning": "è‡ªæˆ‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "resort", "meaning": "è¨´è«¸æ–¼ (v.) / è¨´æ±‚ï¼›å‹åœ° (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "corridor", "meaning": "èµ°å»Š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "immense", "meaning": "ç„¡é™çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "immensity", "meaning": "ç„¡é™ï¼›æ¥µåº¦åš´é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "carbon", "meaning": "ç¢³ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "carbohydrate", "meaning": "ç¢³æ°´åŒ–åˆç‰© (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "applause", "meaning": "é¼“æŒ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "saddle", "meaning": "é¦¬é (n.) / ç‚ºé¦¬ä¸Šé (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "assault", "meaning": "è¥²æ“Š (v.) / è¥²æ“Š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "slam", "meaning": "ç °ç„¶é—œä¸Š (v.) / ç °ç„¶é—œä¸Š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "currency", "meaning": "æµé€šï¼›è²¨å¹£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "current", "meaning": "ç¾è¡Œçš„ (a.) / é›»æµ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "likelihood", "meaning": "å¯èƒ½æ€§ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "shiver", "meaning": "ç™¼æŠ– (n.) / ç™¼æŠ– (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "quiver", "meaning": "é¡«æŠ– (v.) / é¡«æŠ– (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "counsel", "meaning": "å‹¸å‘Š (v.) / å‹¸å‘Š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "counselor", "meaning": "é¡§å•ï¼›è¼”å°å“¡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "counseling", "meaning": "è«®å•† (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "consultation", "meaning": "å•†è­° (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "consult", "meaning": "å•†è­° (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "vertical", "meaning": "å‚ç›´çš„ (a.) / å‚ç›´ç·š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "horizontal", "meaning": "æ°´å¹³çš„ (a.) / æ°´å¹³ç·š (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "scrap", "meaning": "ç¢ç‰‡ (n.) / å»¢é™¤ï¼›å»¢æ£„ (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "dialect", "meaning": "æ–¹è¨€ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "creek", "meaning": "å°æºªæµ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "muscular", "meaning": "è‚Œè‚‰çš„ï¼›è‚Œè‚‰ç™¼é”çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "masculine", "meaning": "ç”·æ€§çš„ï¼›é™½å‰›çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "profile", "meaning": "å´é¢ï¼›è¼ªå»“ï¼›äººç‰©ç°¡ä»‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "grim", "meaning": "åš´å²çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "stack", "meaning": "ä¸€ç–Š (n.) / å †ç–Š (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "noticeable", "meaning": "é¡¯è‘—çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "cluster", "meaning": "ä¸²ï¼›æŸ (n.) / ç¾¤èš (v.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "tournament", "meaning": "è¯è³½ï¼›éŒ¦æ¨™è³½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "asset", "meaning": "è³‡ç”¢ (n.)", "tags": ["æ™Ÿæ™¯Lv5U7"]},
    {"english": "journalist", "meaning": "æ–°èè¨˜è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "journalism", "meaning": "æ–°èå­¸ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "mock", "meaning": "å˜²å¼„ (v.) / æ¨¡æ“¬çš„ï¼›å‡çš„ (a.) / æ¨¡æ“¬æ¸¬é©— (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "intent", "meaning": "ç›®çš„ (n.) / ä¸€å¿ƒä¸€æ„æƒ³è¦... (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "intend", "meaning": "æ‰“ç®— (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "intention", "meaning": "æ„å‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "soak", "meaning": "æµ¸æ³¡ (v.) / æµ¸æ³¡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "soaked", "meaning": "æº¼çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "tin", "meaning": "éŒ«ï¼›ç½é ­ (n.) / å°‡é£Ÿç‰©è£ç½ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "delegate", "meaning": "ä»£è¡¨ (n.) / å§”è¨— (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "delegation", "meaning": "ä»£è¡¨åœ˜ï¼›å§”ä»» (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "trim", "meaning": "åˆªæ¸›ï¼›ä¿®å‰ª (v.) / ä¿®å‰ª (n.) / ä¿®å‰ªæ•´é½Šçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "thigh", "meaning": "å¤§è…¿ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "statistical", "meaning": "çµ±è¨ˆçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "statistic", "meaning": "çµ±è¨ˆæ•¸å­— (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "alien", "meaning": "ä¸ç†Ÿæ‚‰çš„ï¼›ç•°åœ‹çš„ (a.) / å¤–æ˜Ÿäººï¼›å¤–åœ‹äºº (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "stereotype", "meaning": "åˆ»æ¿å°è±¡ (n.) / ä½¿å®šå‹ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "molecule", "meaning": "åˆ†å­ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "nominate", "meaning": "æåï¼›ä»»å‘½ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "nomination", "meaning": "æå (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "nominee", "meaning": "è¢«æåè€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "framework", "meaning": "æ¡†æ¶ï¼›é«”åˆ¶ï¼›æ¶æ§‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "frame", "meaning": "é‚Šæ¡† (n.) / è£æ¡† (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "notify", "meaning": "é€šçŸ¥ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "transparent", "meaning": "é€æ˜çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "transparency", "meaning": "é€æ˜ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "fatigue", "meaning": "ç–²å€¦ (n.) / ä½¿ç–²å€¦ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "outsider", "meaning": "å±€å¤–äºº (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "fascinate", "meaning": "ä½¿...è‘—è¿· (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "compact", "meaning": "ç·Šå¯†çš„ï¼›è¿·ä½ çš„ï¼›å°å·§çš„ (a.) / ä½¿ç·Šå¯† (v.) / å°å‹è»Š (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "juvenile", "meaning": "é’å°‘å¹´çš„ (a.) / é’å°‘å¹´ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "adolescent", "meaning": "é’æ˜¥æœŸçš„ (a.) / é’å°‘å¹´ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "dough", "meaning": "éºµåœ˜ï¼›éŒ¢ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "ballot", "meaning": "æŠ•ç¥¨ï¼›é¸ç¥¨ (n.) / ä¸è¨˜åæŠ•ç¥¨ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "stall", "meaning": "æ”¤ä½ï¼›æŸµæ¬„ï¼›å°éš”é–“ (n.) / æ‹–å»¶ï¼›æ‹‹éŒ¨ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "rib", "meaning": "è‚‹éª¨ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "wilderness", "meaning": "è’é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "wildlife", "meaning": "é‡ç”Ÿå‹•ç‰© (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "indifferent", "meaning": "å†·æ¼ çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "attendance", "meaning": "å‡ºå¸­ï¼›ç…§é¡§ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "abolish", "meaning": "å»¢æ­¢ (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "abolition", "meaning": "å»¢æ­¢ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "agenda", "meaning": "è­°ç¨‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "agony", "meaning": "ç—›è‹¦ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "aisle", "meaning": "èµ°é“ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "allergy", "meaning": "éæ• (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "allergic", "meaning": "éæ•çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "alternate", "meaning": "äº¤æ›¿ï¼›è¼ªæµ (v.) / è¼ªæµçš„ï¼›äº¤æ›¿çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "antique", "meaning": "å¤è‘£ (n.) / å¤è‘£çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "arena", "meaning": "ç«¶æŠ€å ´ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "ass", "meaning": "å±è‚¡ï¼›å‚»è›‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "astonish", "meaning": "ä½¿...éœ‡é©š (v.)", "tags": ["æ™Ÿæ™¯Lv5U8"]},
    {"english": "ban", "meaning": "ç¦æ­¢ (v.) / ç¦ä»¤ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "belongings", "meaning": "è²¡ç”¢ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "beneficial", "meaning": "æœ‰ç›Šçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "beware", "meaning": "æé˜²ï¼›å°å¿ƒ (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "bolt", "meaning": "ä¸€é“é–ƒé›» (n.) / è¡ (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "bonus", "meaning": "ç´…åˆ©ï¼›åŠ ç¢¼ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "boom", "meaning": "ç¹æ¦®ï¼›è½Ÿéš†è² (n.) / ä½¿ç¹æ¦® (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "booth", "meaning": "å°äº­å­ï¼›æ”¤ä½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "briefcase", "meaning": "å…¬äº‹åŒ… (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "bully", "meaning": "æƒ¡éœ¸ (n.) / æ¬ºè²  (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "canal", "meaning": "é‹æ²³ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "celebrity", "meaning": "åäºº (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "certificate", "meaning": "è­‰æ˜æ›¸ (n.) / æˆäºˆ...è­‰æ›¸ (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "choir", "meaning": "å”±è©©ç­ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "clause", "meaning": "æ¢æ¬¾ï¼›å­å¥ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "comedian", "meaning": "è«§æ˜Ÿ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "commentator", "meaning": "åå˜´ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "commentary", "meaning": "å¯¦æ³æ’­å ±ï¼›è©•è«–ï¼›è¨»è§£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "compliment", "meaning": "æ­ç¶­ (v.) / æ­ç¶­ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "comprehend", "meaning": "é ˜æ‚Ÿï¼›ç†è§£ (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "comprehension", "meaning": "ç†è§£ï¼›ç†è§£åŠ› (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "comprehensible", "meaning": "å¯ç†è§£çš„ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "contagious", "meaning": "å…·æ„ŸæŸ“åŠ›çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "contaminate", "meaning": "æ±™æŸ“ï¼›æ±™è¡Š (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "contamination", "meaning": "æ±™æŸ“ï¼›ç·æ±™ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "copyright", "meaning": "è‘—ä½œæ¬Š (n.) / ç‚º...å–å¾—è‘—ä½œæ¬Š (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "customs", "meaning": "æµ·é—œï¼›é—œç¨… (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "deceive", "meaning": "æ¬ºé¨™ (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "deception", "meaning": "æ¬ºé¨™ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "deceptive", "meaning": "é¨™äººçš„ï¼›èª¤å°çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "destination", "meaning": "ç›®çš„åœ° (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "exile", "meaning": "æµæ”¾ (v.) / æµæ”¾ï¼›é›¢é„‰èƒŒäº• (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "extinct", "meaning": "çµ•ç¨®çš„ï¼›æ»…çµ•çš„ï¼›ç†„ç«çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "extinction", "meaning": "æ¶ˆæ»…ï¼›æ»…çµ• (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "format", "meaning": "æ ¼å¼ (n.) / æ ¼å¼åŒ– (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "gorgeous", "meaning": "æ¥µå¥½çš„ï¼›æ¥µç¾çš„ï¼›å®œäººçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "gravity", "meaning": "åœ°å¿ƒå¼•åŠ› (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "greed", "meaning": "è²ªå¿ƒï¼›è²ªåƒ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "greedy", "meaning": "è²ªå¿ƒçš„ï¼›è²ªåƒçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "guideline", "meaning": "æŒ‡å°æ–¹é‡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "herb", "meaning": "è‰è—¥ï¼›é¦™è‰æ¤ç‰© (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "herbal", "meaning": "è‰è—¥çš„ï¼›é¦™è‰çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "hostage", "meaning": "äººè³ª (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "idiot", "meaning": "ç™½ç™¡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "landlord", "meaning": "æˆ¿æ± (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "lord", "meaning": "é ˜ä¸» (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "mainstream", "meaning": "ä¸»æµ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "stream", "meaning": "æ²³æµ (n.) / æµå‡º (v.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "mansion", "meaning": "å¤§å»ˆï¼›å®˜é‚¸ (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "nasty", "meaning": "æƒ¡æ„çš„ï¼›æƒ¡åŠ£çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "participant", "meaning": "åƒåŠ è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U9"]},
    {"english": "pessimism", "meaning": "æ‚²è§€ä¸»ç¾© (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "pessimist", "meaning": "æ‚²è§€ä¸»ç¾©è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "pulse", "meaning": "è„ˆæè·³å‹• (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "refuge", "meaning": "é¿é›£ï¼›é¿é›£æ‰€ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "refugee", "meaning": "é›£æ°‘ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "sanctuary", "meaning": "é¿é›£æ‰€ï¼›åº‡è­· (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "rival", "meaning": "æ•µå°çš„ï¼›ç«¶çˆ­çš„ (a.) / å°æ‰‹ (n.) / åŒ¹æ•µï¼›èˆ‡...ç«¶çˆ­ (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "scandal", "meaning": "é†œè (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "sow", "meaning": "æ’­ç¨® (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "superstition", "meaning": "è¿·ä¿¡ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "tackle", "meaning": "è™•ç†ï¼›æˆªçƒ (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "thrill", "meaning": "èˆˆå¥®ï¼›è†½æˆ°å¿ƒé©š (n.) / ä½¿...èˆˆå¥® (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "thriller", "meaning": "é©šæ‚šæˆ²åŠ‡/é›»å½±/è®€ç‰© (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "thrilling", "meaning": "åˆºæ¿€çš„ï¼›é©šæ‚šçš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "tuition", "meaning": "æ•™å­¸ï¼›å­¸è²» (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "underline", "meaning": "åœ¨...ä¸‹é¢ç•«ç·š (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "visa", "meaning": "ç°½è­‰ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "warrior", "meaning": "æˆ°å£« (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "whereabouts", "meaning": "è¡Œè¹¤ä¸‹è½ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "wig", "meaning": "å‡é«® (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "yacht", "meaning": "éŠè‰‡ (n.) / é§•é§›/ä¹˜åéŠè‰‡ (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "blur", "meaning": "æ¨¡ç³Š (n.) / è®Šæ¨¡ç³Š (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "bodyguard", "meaning": "ä¿é‘£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "browse", "meaning": "ç€è¦½ (v.) / ç€è¦½ï¼›éš¨æ„è§€çœ‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "browser", "meaning": "ç€è¦½å™¨ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "butcher", "meaning": "å± å¤«ï¼›è‚‰è²© (n.) / å± å®° (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "carnival", "meaning": "å˜‰å¹´è¯ï¼›éœ²å¤©éŠæ¨‚å ´ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "chef", "meaning": "ä¸»å»š (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "considerate", "meaning": "é«”è«’çš„ï¼›é«”è²¼çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "corrupt", "meaning": "è…æ•—çš„ (a.) / è…åŒ–... (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "corruption", "meaning": "è…æ•— (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "democrat", "meaning": "æ°‘ä¸»ä¸»ç¾©è€… (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "democracy", "meaning": "æ°‘ä¸» (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "democratic", "meaning": "æ°‘ä¸»çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "republican", "meaning": "å…±å’Œä¸»ç¾©è€… (n.) / å…±å’Œæ”¿é«”çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "republic", "meaning": "å…±å’Œåœ‹ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "denial", "meaning": "å¦èªï¼›æ‹’çµ• (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "descriptive", "meaning": "æè¿°çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "discriminate", "meaning": "æ­§è¦–ï¼›åˆ†è¾¨ (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "discrimination", "meaning": "æ­§è¦–ï¼›å€åˆ¥ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "dreadful", "meaning": "å¯æ€•çš„ (a.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "dread", "meaning": "ç•æ‡¼ (v.) / ç•æ‡¼ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "exaggeration", "meaning": "èª‡å¤§ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "filter", "meaning": "éæ¿¾å™¨ (n.) / éæ¿¾ (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "gasp", "meaning": "å–˜æ°£ï¼›å€’æŠ½ä¸€å£æ°£ (v.) / å–˜æ°£ï¼›å€’æŠ½ä¸€å£æ°£ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "glare", "meaning": "å¼·å…‰ï¼›æ€’è¦– (n.) / ç™¼å¼·å…‰ï¼›æ€’è¦– (v.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "hockey", "meaning": "æ›²æ£çƒ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "howl", "meaning": "åšå«ï¼›(é¢¨)æ€’è™Ÿ (v.) / åšå« (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "roar", "meaning": "å¼å«ï¼›å’†å“® (v.) / å¼å« (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "laser", "meaning": "é›·å°„ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "lawmaker", "meaning": "ç«‹æ³•è€…ï¼›ç«‹å§” (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "lawsuit", "meaning": "è¨´è¨Ÿ (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]},
    {"english": "massage", "meaning": "æŒ‰æ‘© (v.) / æŒ‰æ‘© (n.)", "tags": ["æ™Ÿæ™¯Lv5U10"]}
];
    window.defaultWordDatabase = defaultWordDatabase;
</script>

<!-- å°è¦½åˆ— -->
<nav class="bg-indigo-600 text-white p-4 shadow-lg sticky top-0 z-50">
    <div class="flex flex-col gap-3">
        <div class="flex justify-between items-center w-full">
            <!-- å·¦å´ï¼šLogo + æ¨™é¡Œ + è¨­å®š -->
            <div class="flex items-center gap-2">
                <!-- Logoï¼šé€£åˆ°é¦–é ã€Œåˆ†é ã€ -->
                <h1 class="text-2xl font-bold tracking-tight cursor-pointer flex items-center gap-2" onclick="navigateTo('home')">
                    <span>ğŸ“</span> å–®å­—ç‹
                </h1>
                <!-- è¨­å®šæŒ‰éˆ•ï¼šç·Šè²¼åœ¨ã€Œå–®å­—ç‹ã€å³é‚Š -->
                <button
                    type="button"
                    onclick="openSettingsModal()"
                    class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-indigo-500 text-white text-lg shadow-md active:scale-95 transition"
                    title="è¨­å®š">
                    âš™
                </button>
            </div>

            <!-- å³å´ï¼šæœå°‹ ï¼‹ ç™»å…¥/ç™»å‡º/åŒæ­¥ -->
            <div class="flex items-center gap-2">
                <!-- æœå°‹æ¡† -->
                <div class="relative flex items-center">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="æœå°‹..."
                        class="w-32 sm:w-48 pl-3 pr-8 py-1 rounded-full text-gray-800 text-sm focus:w-40 sm:focus:w-56 transition-all outline-none"
                        onkeypress="if(event.key === 'Enter') searchWord()">
                    <button onclick="searchWord()" class="absolute right-2 text-gray-500 hover:text-indigo-600">
                        ğŸ”
                    </button>
                </div>

                <!-- ä½¿ç”¨è€…è³‡è¨Š ï¼‹ ç™»å…¥ / ç™»å‡º / åŒæ­¥ -->
                <div class="flex items-center gap-1">
                    <span
                        id="user-email"
                        class="hidden text-xs sm:text-sm bg-indigo-500/40 px-2 py-1 rounded-full max-w-[120px] sm:max-w-[200px] truncate">
                    </span>

                    <button
                        id="btn-login"
                        onclick="firebaseLogin()"
                        class="bg-white text-indigo-600 px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow-md active:scale-95 transition">
                        ç™»å…¥
                    </button>

                    <button
                        id="btn-logout"
                        onclick="firebaseLogout()"
                        class="hidden bg-indigo-500 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow-md active:scale-95 transition">
                        ç™»å‡º
                    </button>

                    <button
                        id="btn-sync"
                        onclick="syncCloudNow()"
                        class="hidden bg-amber-400 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow-md active:scale-95 transition">
                        â˜ åŒæ­¥
                    </button>
                </div>
            </div>
        </div>

        <!-- å°è¦½æŒ‰éˆ•ï¼šæ”¹ç”¨ navigateToï¼Œä¸¦æ›´æ–°ç¶²å€ -->
        <div class="grid grid-cols-3 gap-2">
            <button onclick="navigateTo('home')" class="bg-indigo-500 hover:bg-indigo-700 py-2 rounded-lg text-sm font-bold transition">é¦–é </button>
            <button onclick="navigateTo('library')" class="bg-indigo-500 hover:bg-indigo-700 py-2 rounded-lg text-sm font-bold transition">å–®å­—åº«</button>
            <button onclick="navigateTo('practice')" class="bg-indigo-500 hover:bg-indigo-700 py-2 rounded-lg text-sm font-bold transition">ç·´ç¿’å€</button>
        </div>
    </div>
</nav>

<main class="w-full px-4 py-6">
    <!-- é¦–é  -->
    <div id="view-home" class="space-y-6 animate-in fade-in duration-500">
        <div class="text-center py-4">
            <h2 class="text-3xl font-extrabold text-gray-800">æ­¡è¿å›ä¾†ï¼</h2>
            <p class="text-gray-600 mt-2 text-base">è³‡æ–™å·²å­˜æ–¼æœ¬æ©Ÿ (LocalStorage)ï¼Œç™»å…¥å¾Œå¯åŒæ­¥è‡³é›²ç«¯</p>
        </div>

        <div class="flex flex-col gap-4">
            <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-indigo-500 cursor-pointer active:bg-gray-50" onclick="navigateTo('library')">
                <h3 class="text-xl font-bold text-gray-800">ğŸ“– è³‡æ–™å¤¾æ¸…å–®</h3>
                <p class="text-gray-500 mt-1">ç€è¦½ã€ç·¨è¼¯å–®å­—èˆ‡è³‡æ–™å¤¾</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-green-500 cursor-pointer active:bg-gray-50" onclick="navigateTo('practice')">
                <h3 class="text-xl font-bold text-gray-800">ğŸ¯ ç·´ç¿’å°ˆå€</h3>
                <p class="text-gray-500 mt-1">æ‹¼å­—ç·´ç¿’ã€é¸æ“‡é¡ŒæŒ‘æˆ°</p>
            </div>
        </div>
    </div>

    <!-- å–®å­—åº« -->
    <div id="view-library" class="hidden">
        <div class="flex justify-between items-center mb-4">
            <!-- è¿”å›ï¼šä¸Šä¸€é  -->
            <button onclick="history.back()" class="text-gray-500 font-bold px-3 py-2 bg-gray-200 rounded-lg text-sm">â† è¿”å›</button>
            <div class="flex gap-2">
                <button id="btn-edit-folders" onclick="toggleEditMode()" class="bg-orange-500 text-white px-3 py-2 rounded-lg text-sm font-bold shadow-md active:scale-95 transition">ç®¡ç†è³‡æ–™å¤¾</button>
                <button onclick="openAddModal()" class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg text-2xl pb-1 active:scale-95 transition">+</button>
            </div>
        </div>

        <div id="edit-hint" class="hidden bg-orange-100 text-orange-700 p-3 rounded-lg mb-4 text-sm font-bold text-center border border-orange-200">
            âš ï¸ ç·¨è¼¯æ¨¡å¼ï¼šé»æ“Šè³‡æ–™å¤¾é€²è¡Œç®¡ç†
            <div class="mt-2 flex justify-center gap-2">
                <button onclick="openNewFolderModal()" class="bg-green-600 text-white px-3 py-1 rounded text-xs active:scale-95 transition">æ–°å¢è³‡æ–™å¤¾</button>
                <button onclick="toggleEditMode()" class="bg-gray-500 text-white px-3 py-1 rounded text-xs active:scale-95 transition">å®Œæˆç·¨è¼¯</button>
            </div>
        </div>

        <h2 class="text-xl font-bold text-indigo-900 mb-4">è³‡æ–™å¤¾ç›®éŒ„</h2>
        <div class="grid grid-cols-2 gap-3" id="category-grid"></div>
        <div id="empty-library-hint" class="hidden textä¸­å¿ƒ text-gray-400 py-10 text-lg">ç›®å‰æ²’æœ‰å–®å­—<br>è«‹é»æ“Šå³ä¸Šè§’ + æ–°å¢</div>
    </div>

    <!-- å–®å­—åˆ—è¡¨ -->
    <div id="view-word-list" class="hidden">
        <div class="sticky top-0 bg-gray-50 py-2 z-10 flex items-center justify-between mb-2">
            <button onclick="history.back()" class="text-gray-500 font-bold px-3 py-2 bg-gray-200 rounded-lg">â† è¿”å›</button>
            <span id="list-title" class="font-bold text-lg text-indigo-900 truncate max-w-[150px]">åˆ†é¡</span>
            <div class="w-10"></div>
        </div>
        <div class="flex flex-col gap-4" id="words-container"></div>
    </div>

    <!-- ç·´ç¿’å€è¨­å®š -->
    <div id="view-practice" class="hidden">
        <div class="space-y-4">
            <h2 class="text-2xl font-bold text-center text-indigo-900 mt-4">ç‰¹è¨“è¨­å®š</h2>

            <div class="bg-white p-6 rounded-2xl shadow-lg border">
                <!-- Step 1: é¸æ“‡è³‡æ–™å¤¾ -->
                <div class="mb-6">
                    <label class="block font-bold text-gray-700 mb-3 text-lg">ğŸ“‚ 1. é¸æ“‡è³‡æ–™å¤¾</label>
                    <select id="practice-scope" onchange="renderPracticeWordSelection()" class="w-full p-4 border-2 border-indigo-100 rounded-xl text-lg bg-white outline-none focus:border-indigo-500"></select>
                </div>

                <!-- Step 2: å‹¾é¸å–®å­— -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block font-bold text-gray-700 text-lg">ğŸ“ 2. å‹¾é¸è¦ç·´ç¿’çš„å–®å­—</label>
                        <div class="space-x-2">
                            <button onclick="toggleAllPracticeWords(true)" class="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">å…¨é¸</button>
                            <button onclick="toggleAllPracticeWords(false)" class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">å–æ¶ˆ</button>
                        </div>
                    </div>
                    <div id="practice-word-selection" class="max-h-48 overflow-y-auto custom-scrollbar border-2 border-gray-100 rounded-xl p-2 bg-gray-50">
                    </div>
                    <p id="selection-count" class="text-right text-xs text-gray-400 mt-1">å·²é¸ 0 å€‹å–®å­—</p>
                </div>

                <!-- Step 3: é–‹å§‹éŠæˆ² -->
                <div class="flex flex-col gap-4 border-t pt-4">
                    <button onclick="startGame('spelling')" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold text-xl shadow-lg active:scale-95 transition flex items-center justify-center gap-2">
                        ğŸ”¤ æ‹¼å­—ç·´ç¿’
                    </button>
                    <button onclick="startGame('choice-en-ch')" class="w-full py-4 bg-green-600 text-white rounded-xl font-bold text-xl shadow-lg active:scale-95 transition">
                        è‹±é¸ä¸­
                    </button>
                    <button onclick="startGame('choice-ch-en')" class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold text-xl shadow-lg active:scale-95 transition">
                        ä¸­é¸è‹±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‹¼å­—éŠæˆ²ä»‹é¢ -->
    <div id="view-game-spelling" class="hidden">
        <div class="bg-white p-5 rounded-3xl shadow-xl border text-center relative overflow-hidden min-h-[500px] flex flex-col">
            <div class="absolute top-0 left-0 h-2 bg-indigo-500 transition-all duration-300" id="spelling-progress-bar" style="width: 0%"></div>

            <div class="flex justify-between items-center mb-4 mt-2">
                <span id="spelling-progress-text" class="text-base font-bold text-indigo-400">0/0</span>
                <button onclick="quitGameAndSave()" class="text-red-500 font-bold p-2 border border-red-200 rounded-lg hover:bg-red-50">é›¢é–‹ä¸¦çµç®—</button>
            </div>

            <div id="spelling-content" class="flex-1 flex flex-col justify-center">
                <div id="spelling-definition-area" class="space-y-2 mb-6 min-h-[80px] flex flex-col justify-center"></div>
                <div id="spelling-hint" class="text-4xl tracking-[0.1em] font-mono mb-8 text-indigo-600 font-bold break-all"></div>
                <div class="space-y-4 w-full">
                    <input type="text" id="spelling-input" autocomplete="off" class="w-full border-b-4 border-indigo-100 p-3 text-3xl text-center focus:border-indigo-500 outline-none transition-all placeholder-gray-200 rounded-none bg-transparent" placeholder="è¼¸å…¥ç­”æ¡ˆ">
                    <div class="flex flex-col gap-3 mt-4">
                        <button onclick="checkSpellingAnswer()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-xl shadow-md active:bg-indigo-800">æª¢æŸ¥</button>
                        <button onclick="skipSpellingWord()" class="w-full bg-gray-100 text-gray-500 py-4 rounded-xl font-bold text-lg active:bg-gray-200">è·³é (è¦–ç‚ºç­”éŒ¯)</button>
                    </div>
                </div>
                <div id="spelling-feedback" class="mt-4 font-bold text-xl min-h-[2rem]"></div>
            </div>
        </div>
    </div>

    <!-- é¸æ“‡é¡ŒéŠæˆ²ä»‹é¢ -->
    <div id="view-game-choice" class="hidden">
        <div class="bg-white p-5 rounded-3xl shadow-xl border textä¸­å¿ƒ relative overflow-hidden min-h-[500px] flex flex-col">
            <div class="absolute top-0 left-0 h-2 bg-indigo-500 transition-all duration-300" id="choice-progress-bar" style="width: 0%"></div>

            <div class="flex justify-between items-center mb-4 mt-2">
                <span id="choice-progress-text" class="text-base font-bold text-indigo-400">0/0</span>
                <button onclick="quitGameAndSave()" class="text-red-500 font-bold p-2 border border-red-200 rounded-lg hover:bg-red-50">é›¢é–‹ä¸¦çµç®—</button>
            </div>

            <div id="choice-content" class="flex-1 flex flex-col">
                <div class="mb-6 mt-4 p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-100 min-h-[100px] flex items-center justify-center">
                    <h3 id="choice-question" class="text-3xl font-extrabold text-indigo-900 break-words leading-snug">Question</h3>
                </div>
                <div id="choice-options" class="flex flex-col gap-3 w-full flex-1 justify-center"></div>
                <div id="choice-feedback" class="mt-4 font-bold text-xl min-h-[2rem]"></div>
            </div>
        </div>
    </div>

    <!-- é€šç”¨çµç®—ç•«é¢ -->
    <div id="view-game-result" class="hidden">
        <div class="bg-white p-6 rounded-3xl shadow-2xl border text-center min-h-[500px] flex flex-col">
            <div class="py-4">
                <div class="text-6xl mb-2" id="result-icon">ğŸ‰</div>
                <h3 class="text-2xl font-bold text-gray-800" id="result-title">ç·´ç¿’å®Œæˆï¼</h3>
            </div>

            <div class="text-left bg-gray-50 rounded-2xl p-4 border border-gray-100 max-h-[300px] overflow-y-auto custom-scrollbar flex-1">
                <div class="flex justify-between items-center mb-2 border-b pb-2">
                    <span class="font-bold text-gray-600">å¾…è¤‡ç¿’æ¸…å–®</span>
                    <span id="result-stat" class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-bold"></span>
                </div>
                <ul id="result-skipped-items" class="space-y-3"></ul>
            </div>

            <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100 mt-4">
                <label class="block text-sm font-bold text-indigo-900 mb-2">å°‡å‹¾é¸å–®å­—åŠ å…¥åˆ°ï¼š</label>
                <select id="save-target-folder" class="w-full p-3 rounded-lg border border-indigo-200 mb-3 bg-white outline-none font-bold text-gray-700 cursor-pointer hover:border-indigo-400 transition"></select>
                <button onclick="saveWrongWords()" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold text-lg shadow-md hover:bg-indigo-700 active:scale-95 transition">
                    ç¢ºèªåŠ å…¥
                </button>
            </div>

            <button onclick="navigateTo('practice')" class="w-full py-3 mt-3 bg-gray-200 text-gray-600 rounded-xl font-bold text-lg active:scale-95 transition">
                ä¸å„²å­˜ï¼Œç›´æ¥è¿”å›
            </button>
        </div>
    </div>
</main>

<!-- æ–°å¢/ç·¨è¼¯å–®å­— Modal -->
<div id="add-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[100]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
        <h3 id="modal-title" class="text-xl font-bold mb-4 text-center">æ–°å¢å–®å­—</h3>
        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1">è‹±æ–‡</label>
                <input type="text" id="new-word" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-indigo-500 outline-none text-lg">
            </div>
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1">ä¸­æ–‡èˆ‡è©æ€§</label>
                <input type="text" id="new-meaning" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-indigo-500 outline-none text-lg">
            </div>
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1">è³‡æ–™å¤¾/æ¨™ç±¤</label>

                <!-- æ—¢æœ‰è³‡æ–™å¤¾è¤‡é¸ -->
                <div
                    id="tag-checkbox-container"
                    class="mt-1 max-h-32 overflow-y-auto custom-scrollbar border-2 border-gray-200 rounded-xl bg-gray-50 p-2 text-sm space-y-1">
                </div>

                <!-- æ–°å¢è³‡æ–™å¤¾ï¼ˆé¸å¡«ï¼‰ -->
                <input
                    type="text"
                    id="new-tag"
                    placeholder="å¯é¸ï¼šæ–°å¢è³‡æ–™å¤¾ï¼Œå¤šå€‹ç”¨é€—è™Ÿåˆ†éš”"
                    class="mt-2 w-full border-2 border-gray-200 p-2 rounded-xl focus:border-indigo-500 outline-none text-sm">

                <p class="text-xs text-gray-400 mt-1 ml-1">
                    * è‹¥è¦ç§»å‡ºã€ŒéŒ¯é¡Œå€ã€ï¼Œè«‹åœ¨ä¸Šæ–¹æ¸…å–®å–æ¶ˆå‹¾é¸ã€ŒéŒ¯é¡Œå€ã€
                </p>
            </div>
            <div class="grid grid-cols-2 gap-3 pt-2">
                <button onclick="closeAddModal()" class="py-3 text-gray-500 font-bold bg-gray-100 rounded-xl active:bg-gray-200 transition">å–æ¶ˆ</button>
                <button onclick="saveNewWord()" class="py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-md active:bg-indigo-700 transition">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<!-- è³‡æ–™å¤¾ç®¡ç† - é¸æ“‡æ“ä½œ Modal -->
<div id="folder-action-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[110]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl text-center">
        <h3 class="text-xl font-bold mb-4">ç®¡ç†è³‡æ–™å¤¾: <span id="action-folder-name" class="text-indigo-600"></span></h3>
        <div class="flex flex-col gap-3">
            <button onclick="prepareRenameFolder()" class="w-full py-3 bg-blue-500 text-white rounded-xl font-bold active:scale-95 transition">é‡å‘½å</button>
            <button onclick="prepareDeleteFolder(false)" class="w-full py-3 bg-orange-500 text-white rounded-xl font-bold active:scale-95 transition">åˆªé™¤è³‡æ–™å¤¾ (ä¿ç•™å–®å­—)</button>
            <button onclick="prepareDeleteFolder(true)" class="w-full py-3 bg-red-600 text-white rounded-xl font-bold active:scale-95 transition">åˆªé™¤è³‡æ–™å¤¾èˆ‡å–®å­—</button>
            <button onclick="closeActionModal()" class="w-full py-3 bg-gray-200 text-gray-600 rounded-xl font-bold active:scale-95 transition">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<!-- è³‡æ–™å¤¾ç®¡ç† - é‡å‘½å Modal -->
<div id="rename-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[120]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
        <h3 class="text-xl font-bold mb-4 text-center">é‡å‘½åè³‡æ–™å¤¾</h3>
        <input type="text" id="input-rename-folder" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-indigo-500 outline-none text-lg mb-4">
        <div class="grid grid-cols-2 gap-3">
            <button onclick="document.getElementById('rename-modal').classList.add('hidden')" class="py-3 text-gray-500 font-bold bg-gray-100 rounded-xl active:bg-gray-200 transition">å–æ¶ˆ</button>
            <button onclick="executeRename()" class="py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md active:bg-blue-700 transition">ç¢ºèª</button>
        </div>
    </div>
</div>

<!-- è³‡æ–™å¤¾ç®¡ç† - åˆªé™¤ç¢ºèª Modal -->
<div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[130]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl text-center">
        <div class="text-5xl mb-4">âš ï¸</div>
        <h3 id="confirm-title" class="text-xl font-bold mb-2">ç¢ºå®šåˆªé™¤ï¼Ÿ</h3>
        <p id="confirm-desc" class="text-gray-500 mb-6">æ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚</p>
        <div class="grid grid-cols-2 gap-3">
            <button onclick="document.getElementById('confirm-modal').classList.add('hidden')" class="py-3 text-gray-500 font-bold bg-gray-100 rounded-xl active:bg-gray-200 transition">å–æ¶ˆ</button>
            <button onclick="executeDelete()" class="py-3 bg-red-600 text-white rounded-xl font-bold shadow-md active:bg-red-700 transition">ç¢ºèªåˆªé™¤</button>
        </div>
    </div>
</div>

<!-- æ–°å¢è³‡æ–™å¤¾ Modal -->
<div id="new-folder-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[120]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
        <h3 class="text-xl font-bold mb-4 text-center">æ–°å¢è³‡æ–™å¤¾</h3>
        <input type="text" id="input-new-folder-name" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-indigo-500 outline-none text-lg mb-4" placeholder="è¼¸å…¥åç¨±">
        <div class="grid grid-cols-2 gap-3">
            <button onclick="document.getElementById('new-folder-modal').classList.add('hidden')" class="py-3 text-gray-500 font-bold bg-gray-100 rounded-xl active:bg-gray-200 transition">å–æ¶ˆ</button>
            <button onclick="confirmNewFolder()" class="py-3 bg-green-600 text-white rounded-xl font-bold shadow-md active:bg-green-700 transition">å»ºç«‹</button>
        </div>
    </div>
</div>

<!-- ç³»çµ±è¨­å®š Modal -->
<div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-[95]">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
        <h3 class="text-xl font-bold mb-4 text-center">ç³»çµ±è¨­å®š</h3>

        <div class="space-y-6">
            <!-- èƒŒæ™¯éŸ³æ¨‚é–‹é—œ + æ›²ç›®é¸æ“‡ -->
            <div class="border-b pb-4 space-y-3">
                <label class="flex items-center justify-between">
                    <span class="font-bold text-gray-700">å•Ÿç”¨èƒŒæ™¯éŸ³æ¨‚</span>
                    <input
                        type="checkbox"
                        id="settings-bgm-enabled"
                        class="w-5 h-5"
                        onchange="toggleBgmEnabledFromCheckbox(this.checked)">
                </label>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">èƒŒæ™¯éŸ³æ¨‚æ›²ç›®</label>
                    <select
                        id="settings-bgm-select"
                        class="w-full border-2 border-gray-200 p-2 rounded-xl focus:border-indigo-500 outline-none text-sm"
                        onchange="changeBgmTrackFromSelect(this.value)">
                        <!-- ç”± JS å‹•æ…‹å¡«å…¥ -->
                    </select>
                </div>
            </div>

            <!-- èƒŒæ™¯éŸ³æ¨‚éŸ³é‡ -->
            <div>
                <div class="flex items-center justify-between mb-1">
                    <label class="block text-sm font-bold text-gray-700">èƒŒæ™¯éŸ³æ¨‚éŸ³é‡</label>
                    <span id="settings-bgm-volume-value" class="text-xs text-gray-500">50%</span>
                </div>
                <input
                    type="range"
                    id="settings-bgm-volume"
                    min="0"
                    max="100"
                    step="1"
                    class="w-full"
                    oninput="updateBgmVolumeFromSlider(this.value)">
            </div>

            <!-- å–®å­—ç™¼éŸ³éŸ³é‡ -->
            <div>
                <div class="flex items-center justify-between mb-1">
                    <label class="block text-sm font-bold text-gray-700">å–®å­—ç™¼éŸ³éŸ³é‡</label>
                    <span id="settings-speech-volume-value" class="text-xs text-gray-500">100%</span>
                </div>
                <input
                    type="range"
                    id="settings-speech-volume"
                    min="0"
                    max="100"
                    step="1"
                    class="w-full"
                    oninput="updateSpeechVolumeFromSlider(this.value)">
            </div>

            <button
                onclick="closeSettingsModal()"
                class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-md active:bg-indigo-700 transition">
                å®Œæˆ
            </button>
        </div>
    </div>
</div>

<!-- ä¸»ç¨‹å¼è…³æœ¬ï¼ˆé moduleï¼Œæ›åœ¨ window ä¸Šï¼‰ -->
<script>
    const STORAGE_KEY = 'wordKingData_v2';

    // èƒŒæ™¯éŸ³æ¨‚æ¸…å–®ï¼šå…©é¦–ä½ çš„æœ¬æ©ŸéŸ³æ¨‚ + ä¸€é¦–å…¬ç”¨æ¸¬è©¦éŸ³æ¨‚
    const BGM_TRACKS = [
        {
            id: 'bgm_new_dora',
            name: 'æ–°å“†å•¦Aå¤¢ä¸»é¡Œæ›²',
            // æ–°ç‰ˆä¸»é¡Œæ›²ï¼ˆæ”¾åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼Œå’Œ index.html åŒä¸€å±¤ï¼‰
            url: './æ–°å“†å•¦Aå¤¢ä¸»é¡Œæ›².mp3'
        },
        {
            id: 'bgm_old_dora',
            name: 'å“†å•¦Aå¤¢ä¸»é¡Œæ›²',
            // èˆŠç‰ˆä¸»é¡Œæ›²ï¼ˆåŒæ¨£æ”¾åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰
            url: './èˆŠç‰ˆå“†å•¦Aå¤¢ä¸»é¡Œæ›².mp3'
        },
        {
            id: 'bgm_demo',
            name: 'æ¸¬è©¦éŸ³æ¨‚ï¼ˆå…¬ç”¨ï¼‰',
            // å…¬é–‹å¯ç”¨çš„ç¤ºç¯„ MP3ï¼Œç”¨ä¾†ç¢ºèªç¨‹å¼é‚è¼¯èˆ‡ç€è¦½å™¨ç›¸å®¹æ€§
            url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'
        }
    ];

    const DEFAULT_SETTINGS = {
        bgmEnabled: true,                  // æ˜¯å¦é–‹å•ŸèƒŒæ™¯éŸ³æ¨‚
        bgmVolume: 0.5,                    // 0~1
        speechVolume: 1.0,                 // 0~1
        // é è¨­æ’­æ”¾ã€Œæ–°å“†å•¦Aå¤¢ä¸»é¡Œæ›²ã€é€™é¦–         selectedBgmId: 'bgm_new_dora'    };
    };

    // ç™¼éŸ³æ™‚è¦æŠŠ BGM å£“ä½å¤šå°‘ï¼š0.3 = 30%
    const bgmDucking = {
        isDucking: false,
        ratio: 0.3
    };

    function clamp01(value) {
        const n = typeof value === 'number' ? value : parseFloat(value);
        if (isNaN(n)) return 0;
        return Math.max(0, Math.min(1, n));
    }

    let state = {
        words: [],
        categories: "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(''),
        unitTags: ["éŒ¯é¡Œå€"],
        folders: ["éŒ¯é¡Œå€"],
        settings: { ...DEFAULT_SETTINGS },
        audio: {
            bgmElement: null
        },
        game: {
            mode: '',
            currentWords: [],
            index: 0,
            wrongWords: new Set(),
            reviewSelection: [],
            selectedPracticeWords: []
        },
        isEditing: false,
        editingWordIndex: -1,
        targetFolderAction: '',
        pendingDeleteType: null // 'keep' or 'all'
    };

    window.state = state;

    function hydrateSettings(saved) {
        const base = { ...DEFAULT_SETTINGS };
        if (saved && typeof saved === 'object') {
            if (typeof saved.bgmEnabled === 'boolean') base.bgmEnabled = saved.bgmEnabled;
            if (typeof saved.bgmVolume === 'number') base.bgmVolume = clamp01(saved.bgmVolume);
            if (typeof saved.speechVolume === 'number') base.speechVolume = clamp01(saved.speechVolume);
            if (typeof saved.selectedBgmId === 'string') base.selectedBgmId = saved.selectedBgmId;
        }
        return base;
    }

    function getCurrentBgmTrack() {
        const id = state.settings && state.settings.selectedBgmId;
        const found = BGM_TRACKS.find(t => t.id === id);
        return found || BGM_TRACKS[0] || null;
    }

    function setupAudioSystem() {
        let audio = document.getElementById('bgm-audio');
        if (!audio) {
            audio = document.createElement('audio');
            audio.id = 'bgm-audio';
            audio.className = 'hidden';
            document.body.appendChild(audio);
        }
        audio.loop = true;
        audio.preload = 'auto';

        const track = getCurrentBgmTrack();
        if (track) {
            audio.src = track.url;
        }

        // è‹¥è¼‰å…¥éŸ³æ¨‚æª”å¤±æ•—ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯ï¼Œæ–¹ä¾¿æª¢æŸ¥è·¯å¾‘æˆ–é›²ç«¯é€£çµ
        audio.onerror = () => {
            console.error('èƒŒæ™¯éŸ³æ¨‚è¼‰å…¥å¤±æ•—', {
                src: audio.currentSrc || audio.src,
                error: audio.error
            });
            if (!audio._bgmErrorNotified) {
                audio._bgmErrorNotified = true;
                alert(
                    'èƒŒæ™¯éŸ³æ¨‚è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªï¼š\n' +
                    '1. æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œè·¯å¾‘æ˜¯å¦æ­£ç¢º\n' +
                    '2. å¦‚æœæ˜¯é›²ç«¯é€£çµï¼Œæª”æ¡ˆæ˜¯å¦è¨­ç‚ºã€Œæ“æœ‰é€£çµè€…å¯æŸ¥çœ‹ã€\n' +
                    '3. æª”æ¡ˆæ ¼å¼æ˜¯å¦ç‚ºç€è¦½å™¨å¯æ’­æ”¾çš„éŸ³è¨Šæ ¼å¼ï¼ˆä¾‹å¦‚ mp3ï¼‰'
                );
            }
        };

        state.audio = state.audio || {};
        state.audio.bgmElement = audio;
        applyBgmSettingsToElement();
    }

    function applyBgmSettingsToElement() {
        if (!state.audio || !state.audio.bgmElement) return;
        const audio = state.audio.bgmElement;

        audio.volume = clamp01(state.settings.bgmVolume);

        if (state.settings.bgmEnabled) {
            audio.play().catch(() => {
                // æœ‰äº›ç€è¦½å™¨æœƒé˜»æ“‹è‡ªå‹•æ’­æ”¾ï¼Œéœ€è¦ä½¿ç”¨è€…äº’å‹•
            });
        } else {
            audio.pause();
        }
    }
    window.applyBgmSettingsToElement = applyBgmSettingsToElement;

    // ç‚ºäº†ç¬¦åˆç€è¦½å™¨è‡ªå‹•æ’­æ”¾æ”¿ç­–ï¼šåœ¨ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡äº’å‹•æ™‚å†å˜—è©¦æ’­æ”¾ BGM
    function setupBgmAutoplayUnlock() {
        const audio =
            (state.audio && state.audio.bgmElement) ||
            document.getElementById('bgm-audio');
        if (!audio) return;

        const tryPlay = () => {
            if (!state.settings || !state.settings.bgmEnabled) return;
            audio.play().catch(() => {});
            window.removeEventListener('click', tryPlay);
            window.removeEventListener('touchstart', tryPlay);
            window.removeEventListener('keydown', tryPlay);
        };

        window.addEventListener('click', tryPlay, { once: true });
        window.addEventListener('touchstart', tryPlay, { once: true });
        window.addEventListener('keydown', tryPlay, { once: true });
    }

    // æ–°ç‰ˆç™¼éŸ³åŠŸèƒ½ï¼ˆæœƒè‡ªå‹•å£“ä½èƒŒæ™¯éŸ³é‡ï¼‰
    window.speakWord = function(text) {
        if (!('speechSynthesis' in window)) {
            alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½");
            return;
        }

        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';

        const speechVol =
            clamp01(state.settings && typeof state.settings.speechVolume === 'number'
                ? state.settings.speechVolume
                : DEFAULT_SETTINGS.speechVolume);
        utterance.volume = speechVol;

        const bgmEl = (state.audio && state.audio.bgmElement) || document.getElementById('bgm-audio');
        const shouldDuck =
            bgmEl &&
            !bgmEl.paused &&
            state.settings &&
            state.settings.bgmEnabled;

        if (shouldDuck) {
            bgmDucking.isDucking = true;
            bgmEl.volume = clamp01(state.settings.bgmVolume * bgmDucking.ratio);

            const restore = () => {
                bgmDucking.isDucking = false;
                bgmEl.volume = clamp01(state.settings.bgmVolume);
                utterance.onend = null;
                utterance.onerror = null;
            };

            utterance.onend = restore;
            utterance.onerror = restore;
        }

        window.speechSynthesis.speak(utterance);
    };

    // è®“ç¶²å€æœ‰ page åƒæ•¸ï¼Œä¾‹å¦‚ ?page=library
    function navigateTo(viewId) {
        showView(viewId);
        try {
            const url = new URL(window.location);
            url.searchParams.set('page', viewId);
            history.pushState({ viewId }, '', url);
        } catch (e) {
            console.log("History API not supported or restricted:", e);
        }
    }

    window.onpopstate = (event) => {
        const viewId =
            (event.state && event.state.viewId) ||
            new URL(window.location).searchParams.get('page') ||
            'home';
        showView(viewId);
    };

    function initSystem() {
        const storedData = localStorage.getItem(STORAGE_KEY);
        if (storedData) {
            try {
                const parsed = JSON.parse(storedData);
                state.words = parsed.words || [];
                state.folders = parsed.folders || ["éŒ¯é¡Œå€"];
                state.settings = hydrateSettings(parsed.settings);
            } catch(e) {
                state.words = [...defaultWordDatabase];
                state.folders = ["éŒ¯é¡Œå€"];
                state.settings = { ...DEFAULT_SETTINGS };
            }
        } else {
            state.words = [...defaultWordDatabase];
            state.folders = ["éŒ¯é¡Œå€"];
            state.settings = { ...DEFAULT_SETTINGS };
        }
        if (!state.folders.includes("éŒ¯é¡Œå€")) state.folders.unshift("éŒ¯é¡Œå€");
        refreshTags();
        if (state.words.length > 0 || state.folders.length > 1) saveDataLocally();
    }

    // å°‡è³‡æ–™å¤¾åç¨±æ‹†æˆã€Œå‰ç¶´æ–‡å­—ã€+ã€Œæ•¸å­—åºåˆ—ã€
    // ä¾‹å¦‚ï¼š
    //  "æ™Ÿæ™¯Lv5U6"      -> prefix: "æ™Ÿæ™¯Lv", numbers: [5, 6]
    //  "æ™Ÿæ™¯å–®å­— Lv5U10" -> prefix: "æ™Ÿæ™¯å–®å­— Lv", numbers: [5, 10]
    //  "é¾é¨°C6U3"       -> prefix: "é¾é¨°C", numbers: [6, 3]
    //  "å­¸æ¸¬å–®å­—"       -> prefix: "å­¸æ¸¬å–®å­—", numbers: []
    function splitTagForSeries(tag) {
        // æŠ“åˆ°ã€Œä¸€é–‹å§‹é€£çºŒçš„éæ•¸å­—ã€ç•¶ä½œå‰ç¶´
        const m = tag.match(/^(\D+)(.*)$/);
        if (!m) {
            // é–‹é ­å°±æ˜¯æ•¸å­—ï¼Œç•¶ä½œæ•´å€‹éƒ½æ˜¯å‰ç¶´ï¼ˆæ²’æœ‰ç³»åˆ—æ•¸å­—ï¼‰
            return { prefix: tag, numbers: [] };
        }
        const prefix = m[1].trim();
        const rest = m[2];

        if (!rest) {
            return { prefix, numbers: [] };
        }

        // æŠŠå¾Œé¢æ‰€æœ‰æ•¸å­—æŠ“å‡ºä¾†ï¼Œç…§å‡ºç¾é †åºçµ„æˆé™£åˆ—
        const nums = rest.match(/\d+/g);
        const numbers = nums ? nums.map(n => parseInt(n, 10)) : [];

        return { prefix, numbers };
    }

    // è‡ªè¨‚æ¨™ç±¤æ’åºï¼š
    // 1. ã€ŒéŒ¯é¡Œå€ã€æ°¸é æ’åˆ°æœ€å¾Œ
    // 2. å…¶é¤˜æ¨™ç±¤ï¼Œå…ˆæŒ‰ã€Œå‰ç¶´ã€ç¾¤çµ„ï¼ˆåå­—ç›¸ä¼¼åº¦ï¼‰ï¼Œ
    //    åŒå‰ç¶´æ™‚ç”¨æ•¸å­—åºåˆ—æ’åºï¼ˆU5, U6, U7, U10 æœƒæ’æˆ 5,6,7,10ï¼‰ï¼Œ
    //    æ²’æ•¸å­—å°±ç”¨å­—å…¸é †åºã€‚
    function compareTagsBySeries(a, b) {
        // ã€ŒéŒ¯é¡Œå€ã€å›ºå®šåœ¨æœ€å¾Œ
        if (a === "éŒ¯é¡Œå€" && b !== "éŒ¯é¡Œå€") return 1;   // a å¾€å¾Œ
        if (b === "éŒ¯é¡Œå€" && a !== "éŒ¯é¡Œå€") return -1;  // b å¾€å¾Œ

        const sa = splitTagForSeries(a);
        const sb = splitTagForSeries(b);

        // å…ˆæ¯”å‰ç¶´ï¼ˆç³»åˆ—åï¼‰
        if (sa.prefix !== sb.prefix) {
            // ä¸­æ–‡ç”¨ zh-Hant æ’åºæœƒæ¯”è¼ƒè‡ªç„¶
            return sa.prefix.localeCompare(sb.prefix, 'zh-Hant');
        }

        // å‰ç¶´ä¸€æ¨£ï¼šåŒä¸€ç³»åˆ—ï¼Œæ”¹ç”¨æ•¸å­—åºåˆ—æ’åº
        const len = Math.max(sa.numbers.length, sb.numbers.length);
        for (let i = 0; i < len; i++) {
            const na = sa.numbers[i] ?? 0;
            const nb = sb.numbers[i] ?? 0;
            if (na !== nb) return na - nb;
        }

        // æ•¸å­—ä¹Ÿä¸€æ¨£æˆ–éƒ½æ²’æœ‰æ•¸å­—æ™‚ï¼Œæœ€å¾Œå†æ¯”æ•´å€‹å­—ä¸²
        return a.localeCompare(b, 'zh-Hant');
    }

    function refreshTags() {
        const tagsSet = new Set(state.folders);
        state.words.forEach(w => {
            if (w.tags) w.tags.forEach(t => tagsSet.add(t));
        });
        // ä½¿ç”¨è‡ªè¨‚æ’åºï¼šåŒç³»åˆ—æŒ‰å‰ç¶´ + æ•¸å­—é †åºæ’ï¼Œã€ŒéŒ¯é¡Œå€ã€æ°¸é æœ€å¾Œ
        state.unitTags = Array.from(tagsSet).sort(compareTagsBySeries);

        const datalist = document.getElementById('folder-list');
        if (datalist) {
            datalist.innerHTML = state.unitTags.map(t => `<option value="${t}">`).join('');
        }
    }

    function mergeMeaningStrings(oldMeaning, newMeaning) {
        const splitParts = str =>
            (str || '')
                .split('/')
                .map(s => s.trim())
                .filter(s => s);

        const partsOld = splitParts(oldMeaning);
        const partsNew = splitParts(newMeaning);

        const seen = new Set();
        const merged = [];

        partsOld.forEach(p => {
            if (!seen.has(p)) {
                seen.add(p);
                merged.push(p);
            }
        });
        partsNew.forEach(p => {
            if (!seen.has(p)) {
                seen.add(p);
                merged.push(p);
            }
        });

        return merged.join(' / ');
    }

    function mergeDuplicateWords(words) {
        const map = new Map();

        (words || []).forEach(w => {
            if (!w || !w.english) return;
            const key = w.english.toLowerCase();
            const incomingTags = Array.isArray(w.tags) ? w.tags : [];

            if (!map.has(key)) {
                map.set(key, {
                    english: w.english,
                    meaning: w.meaning || '',
                    tags: Array.from(new Set(incomingTags))
                });
            } else {
                const exists = map.get(key);

                exists.meaning = mergeMeaningStrings(exists.meaning, w.meaning);

                const mergedTags = Array.from(
                    new Set([...(exists.tags || []), ...incomingTags])
                );
                exists.tags = mergedTags;

                map.set(key, exists);
            }
        });

        return Array.from(map.values());
    }

    function renderTagCheckboxes(selectedTags = []) {
        const container = document.getElementById('tag-checkbox-container');
        if (!container) return;

        const allTags = state.unitTags || [];
        container.innerHTML = '';

        if (allTags.length === 0) {
            container.innerHTML = '<div class="text-xs text-gray-400">ç›®å‰æ²’æœ‰è³‡æ–™å¤¾ï¼Œè«‹å…ˆå»ºç«‹ã€‚</div>';
            return;
        }

        allTags.forEach(tag => {
            const safeId = 'tag-chk-' + tag.replace(/\s+/g, '_');
            const wrapper = document.createElement('label');
            wrapper.className = 'inline-flex items-center space-x-2 mr-3 mb-1';

            const checked = selectedTags.includes(tag) ? 'checked' : '';
            wrapper.innerHTML = `
                <input type="checkbox"
                       class="tag-checkbox w-4 h-4 text-indigo-600 rounded"
                       value="${tag}"
                       id="${safeId}"
                       ${checked}>
                <span class="text-sm text-gray-700">${tag}</span>
            `;

            container.appendChild(wrapper);
        });
    }

    function saveDataLocally() {
        state.words = mergeDuplicateWords(state.words || []);

        const dataToSave = {
            words: state.words,
            folders: state.folders,
            settings: state.settings
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
        refreshTags();

        if (window.autoSyncToCloud) {
            window.autoSyncToCloud();
        }
    }

    function confirmReset() {
        if (!confirm("ç¢ºå®šè¦é‡è£½å—ï¼Ÿ\né€™æœƒåˆªé™¤æ‰€æœ‰è‡ªè¨‚å–®å­—èˆ‡è³‡æ–™å¤¾ï¼Œåªä¿ç•™ç³»çµ±å…§å»ºå–®å­—ã€‚\nè‹¥å·²ç™»å…¥ï¼Œé›²ç«¯ä¹Ÿæœƒä¸€ä½µé‡ç½®ã€‚")) {
            return;
        }

        localStorage.removeItem(STORAGE_KEY);

        state.words = Array.isArray(defaultWordDatabase) ? [...defaultWordDatabase] : [];
        state.folders = ["éŒ¯é¡Œå€"];
        state.settings = { ...DEFAULT_SETTINGS };

        saveDataLocally();
        applyBgmSettingsToElement();
        location.reload();
    }

    function showView(viewId) {
        document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden'));
        const target = document.getElementById(`view-${viewId}`);
        if (target) target.classList.remove('hidden');

        if (viewId === 'library') renderLibrary();
        if (viewId === 'practice') {
            renderPracticeOptions();
            setTimeout(renderPracticeWordSelection, 50);
        }
        window.scrollTo(0, 0);

        if (viewId !== 'library') {
            state.isEditing = false;
            updateEditUI();
        }

        const titleMap = {
            home: 'å–®å­—ç‹ - é¦–é ',
            library: 'å–®å­—ç‹ - å–®å­—åº«',
            practice: 'å–®å­—ç‹ - ç·´ç¿’å€'
        };
        document.title = titleMap[viewId] || 'å–®å­—ç‹ - æ ¸å¿ƒç³»çµ±';
    }

    function searchWord() {
        const query = document.getElementById('search-input').value.trim().toLowerCase();
        if (!query) return;
        const foundWord = state.words.find(w => w.english.toLowerCase() === query || w.meaning.includes(query));
        if (foundWord) {
            const targetTag = foundWord.tags && foundWord.tags.find(t => !state.categories.includes(t)) || (foundWord.tags && foundWord.tags[0]);
            if (targetTag) {
                navigateTo('library');
                showView('word-list');
                renderWordList(targetTag);
                setTimeout(() => {
                    const allCards = document.querySelectorAll('.word-card');
                    let targetCard = null;
                    allCards.forEach(card => {
                        if(card.innerText.toLowerCase().includes(query) || card.innerText.includes(query)) targetCard = card;
                    });
                    if (targetCard) {
                        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        targetCard.classList.add('highlight-card');
                        setTimeout(() => targetCard.classList.remove('highlight-card'), 1500);
                    }
                }, 100);
            } else alert("æ‰¾åˆ°äº†å–®å­—ï¼Œä½†å®ƒä¼¼ä¹æ²’æœ‰åˆ†é¡æ¨™ç±¤ã€‚");
        } else alert("æ‰¾ä¸åˆ°é€™å€‹å–®å­—ï¼");
    }

    function toggleEditMode() { state.isEditing = !state.isEditing; updateEditUI(); renderLibrary(); }
    function updateEditUI() {
        const hint = document.getElementById('edit-hint');
        const btn = document.getElementById('btn-edit-folders');
        if (state.isEditing) {
            hint.classList.remove('hidden');
            btn.classList.replace('bg-orange-500', 'bg-gray-500');
            btn.innerText = 'å®Œæˆç·¨è¼¯';
        } else {
            hint.classList.add('hidden');
            btn.classList.replace('bg-gray-500', 'bg-orange-500');
            btn.innerText = 'ç®¡ç†è³‡æ–™å¤¾';
        }
    }

    function openNewFolderModal() {
        document.getElementById('input-new-folder-name').value = '';
        document.getElementById('new-folder-modal').classList.remove('hidden');
    }

    function confirmNewFolder() {
        const name = document.getElementById('input-new-folder-name').value.trim();
        if (!name) return;
        if (state.folders.includes(name) || state.categories.includes(name)) {
            alert("æ­¤è³‡æ–™å¤¾å·²å­˜åœ¨ï¼");
            return;
        }
        state.folders.push(name);
        saveDataLocally();
        renderLibrary();
        document.getElementById('new-folder-modal').classList.add('hidden');
    }

    function handleFolderClick(name) {
        if (state.isEditing) {
            if (name === "éŒ¯é¡Œå€" || state.categories.includes(name)) {
                alert("æ­¤ç³»çµ±è³‡æ–™å¤¾ç„¡æ³•ç·¨è¼¯æˆ–åˆªé™¤ã€‚");
                return;
            }
            openActionModal(name);
        } else {
            renderWordList(name);
            const url = new URL(window.location);
            url.searchParams.set('page', 'library');
            history.pushState({ viewId: 'library' }, '', url);
        }
    }

    function openActionModal(folderName) {
        state.targetFolderAction = folderName;
        document.getElementById('action-folder-name').innerText = folderName;
        document.getElementById('folder-action-modal').classList.remove('hidden');
    }

    function closeActionModal() {
        document.getElementById('folder-action-modal').classList.add('hidden');
    }

    function prepareRenameFolder() {
        closeActionModal();
        document.getElementById('input-rename-folder').value = state.targetFolderAction;
        document.getElementById('rename-modal').classList.remove('hidden');
    }

    function executeRename() {
        const oldName = state.targetFolderAction;
        const newName = document.getElementById('input-rename-folder').value.trim();

        if (newName && newName !== oldName) {
            if (state.folders.includes(newName) || state.categories.includes(newName)) {
                alert("æ­¤åç¨±å·²å­˜åœ¨æˆ–ç³»çµ±ä¿ç•™ã€‚");
                return;
            }
            state.words.forEach(w => {
                if (w.tags && w.tags.includes(oldName)) {
                    w.tags = w.tags.map(t => t === oldName ? newName : t);
                }
            });
            state.folders = state.folders.map(f => f === oldName ? newName : f);
            saveDataLocally();
            renderLibrary();
        }
        document.getElementById('rename-modal').classList.add('hidden');
        state.targetFolderAction = '';
    }

    function prepareDeleteFolder(deleteAll) {
        closeActionModal();
        state.pendingDeleteType = deleteAll ? 'all' : 'keep';

        const title = document.getElementById('confirm-title');
        const desc = document.getElementById('confirm-desc');

        if (deleteAll) {
            title.innerText = "åˆªé™¤è³‡æ–™å¤¾èˆ‡å–®å­—ï¼Ÿ";
            desc.innerText = "è©²è³‡æ–™å¤¾å…§çš„æ‰€æœ‰å–®å­—éƒ½æœƒè¢«æ°¸ä¹…åˆªé™¤ï¼";
        } else {
            title.innerText = "åƒ…åˆªé™¤è³‡æ–™å¤¾ï¼Ÿ";
            desc.innerText = "å–®å­—æœƒä¿ç•™ï¼Œä½†æœƒç§»é™¤æ­¤è³‡æ–™å¤¾æ¨™ç±¤ã€‚";
        }

        document.getElementById('confirm-modal').classList.remove('hidden');
    }

    function executeDelete() {
        const oldName = state.targetFolderAction;
        const type = state.pendingDeleteType;

        if (type === 'keep') {
            state.words.forEach(w => {
                if (w.tags) w.tags = w.tags.filter(t => t !== oldName);
            });
        } else if (type === 'all') {
            state.words = state.words.filter(w => {
                if (!w.tags) return true;
                return !w.tags.includes(oldName);
            });
        }

        state.folders = state.folders.filter(f => f !== oldName);
        saveDataLocally();
        renderLibrary();

        document.getElementById('confirm-modal').classList.add('hidden');
        state.targetFolderAction = '';
        state.pendingDeleteType = null;
    }

    function openAddModal(idx = -1) {
        state.editingWordIndex = idx;
        const modal = document.getElementById('add-modal');
        const tagInput = document.getElementById('new-tag');

        document.getElementById('modal-title').innerText = idx >= 0 ? "ç·¨è¼¯å–®å­—" : "æ–°å¢å–®å­—";

        if (idx >= 0) {
            const w = state.words[idx];
            document.getElementById('new-word').value = w.english;
            document.getElementById('new-meaning').value = w.meaning;
            const selectedTags = Array.isArray(w.tags) ? w.tags : [];
            renderTagCheckboxes(selectedTags);
            if (tagInput) tagInput.value = '';
        } else {
            document.getElementById('new-word').value = '';
            document.getElementById('new-meaning').value = '';
            let preSelected = [];
            const current = document.getElementById('list-title')?.innerText;
            if (current && !state.categories.includes(current) && current !== 'åˆ†é¡') {
                preSelected = [current];
            }
            renderTagCheckboxes(preSelected);
            if (tagInput) tagInput.value = '';
        }

        modal.classList.remove('hidden');
    }

    function closeAddModal() {
        document.getElementById('add-modal').classList.add('hidden');
        state.editingWordIndex = -1;
    }

    function saveNewWord() {
        const eng = document.getElementById('new-word').value.trim();
        const mean = document.getElementById('new-meaning').value.trim();
        const tagInputEl = document.getElementById('new-tag');

        if (!eng || !mean) return alert("è«‹è¼¸å…¥å–®å­—å’Œæ„æ€");

        const selectedFromCheckbox = Array.from(document.querySelectorAll('.tag-checkbox:checked'))
            .map(cb => cb.value);

        let extraTags = [];
        if (tagInputEl && tagInputEl.value.trim()) {
            extraTags = tagInputEl.value.trim()
                .split(/[,ï¼Œ]/)
                .map(t => t.trim())
                .filter(t => t);
        }

        const tags = Array.from(new Set([...selectedFromCheckbox, ...extraTags]));

        tags.forEach(t => {
            if (!state.folders.includes(t)) state.folders.push(t);
        });

        const data = { english: eng, meaning: mean, tags: tags };

        if (state.editingWordIndex >= 0) {
            state.words[state.editingWordIndex] = data;
        } else {
            state.words.push(data);
        }

        saveDataLocally();
        closeAddModal();

        if (!document.getElementById('view-word-list').classList.contains('hidden')) {
            renderWordList(document.getElementById('list-title').innerText);
        } else {
            renderLibrary();
        }
    }

    function renderLibrary() {
        refreshTags();
        const grid = document.getElementById('category-grid');
        grid.innerHTML = '';
        if(state.isEditing) grid.classList.add('editing-mode'); else grid.classList.remove('editing-mode');

        if(state.words.length === 0 && state.folders.length <= 1) {
            document.getElementById('empty-library-hint').classList.remove('hidden');
        } else {
            document.getElementById('empty-library-hint').classList.add('hidden');
            if(!state.isEditing) {
                state.categories.forEach(cat => {
                    if(state.words.some(w => w.english.toUpperCase().startsWith(cat))) grid.appendChild(createCatBtn(cat, 'bg-white text-indigo-600 border border-indigo-100', false));
                });
            }
            state.unitTags.forEach(tag => {
                const isSystem = tag === "éŒ¯é¡Œå€";
                const count = state.words.filter(w => w.tags && w.tags.includes(tag)).length;
                const style = isSystem ? 'bg-red-500 text-white font-bold' : 'bg-indigo-600 text-white font-bold';
                grid.appendChild(createCatBtn(`${tag} (${count})`, style, !isSystem, tag));
            });
        }
    }

    function createCatBtn(name, cls, editable, oriName) {
        const div = document.createElement('div');
        div.className = `${cls} folder-card relative min-h-[80px] rounded-2xl flex items-center justify-center shadow-sm cursor-pointer active:scale-95 transition-all text-lg text-center px-2 break-all leading-tight`;
        div.innerHTML = `<span>${name}</span>` + (state.isEditing && editable ? '<span class="absolute top-1 right-1 text-xs bg-white text-red-500 rounded-full w-5 h-5 flex items-center justify-center">âœ</span>' : '');
        div.onclick = () => handleFolderClick(oriName || name.split(' ')[0]);
        return div;
    }

    function renderWordList(name) {
        showView('word-list');
        document.getElementById('list-title').innerText = name;
        const container = document.getElementById('words-container');
        container.innerHTML = '';
        let filtered = state.words.map((w,i)=>({...w, idx:i}));
        if(name.length===1 && state.categories.includes(name)) filtered = filtered.filter(w=>w.english.toUpperCase().startsWith(name));
        else filtered = filtered.filter(w=>w.tags && w.tags.includes(name));
        filtered.sort((a,b)=>a.english.localeCompare(b.english));

        if(filtered.length === 0) return container.innerHTML = `<div class="text-center text-gray-400 py-10 w-full">ç„¡å–®å­—</div>`;

        filtered.forEach(w => {
            const card = document.createElement('div');
            card.className = 'word-card w-full';

            const parts = parseMeaning(w.meaning).map(p => `
                <div class="mb-3 text-indigo-800 font-bold text-lg">
                    ${p.text}
                    <span class="block text-sm text-indigo-400 opacity-90 mt-1">${p.pos}</span>
                </div>
            `).join('');

            const badge = w.tags && w.tags.includes("éŒ¯é¡Œå€") ? `<span class="absolute top-3 right-3 text-xs bg-red-100 text-red-500 px-2 py-1 rounded-full font-bold">éŒ¯é¡Œ</span>` : '';

            card.innerHTML = `
                <div class="word-card-inner">
                    <div class="word-card-front bg-white border-2 border-indigo-50 p-6 relative flex flex-col justify-center items-center rounded-2xl">
                        <button class="absolute top-3 left-3 text-gray-400 hover:text-indigo-600 bg-white rounded-full p-1 shadow-sm z-20" onclick="event.stopPropagation(); openAddModal(${w.idx})">âœ</button>
                        ${badge}
                        <span class="text-3xl font-black text-indigo-900 break-all text-center">${w.english}</span>
                        <!-- å–‡å­ç™¼éŸ³æŒ‰éˆ• -->
                        <button class="mt-4 text-indigo-500 hover:text-indigo-700 bg-indigo-50 hover:bg-indigo-100 p-2 rounded-full transition-colors z-20 shadow-sm flex items-center justify-center" onclick="event.stopPropagation(); speakWord('${w.english.replace(/'/g, "\\'")}')" title="ç™¼éŸ³">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                             </svg>
                        </button>
                    </div>
                    <div class="word-card-back p-6 bg-indigo-50 border-2 border-indigo-200 flex flex-col rounded-2xl">
                        ${parts}
                    </div>
                </div>`;
            card.onclick = () => card.classList.toggle('is-flipped');
            container.appendChild(card);
        });
    }

    function parseMeaning(raw) {
        const results = [];
        if (!raw) return results;

        const blocks = raw.split('/').map(b => b.trim()).filter(Boolean);

        blocks.forEach(block => {
            if (!block) return;
            const idx = block.lastIndexOf('(');
            let textPart = block;
            let posPart = '';

            if (idx !== -1) {
                textPart = block.substring(0, idx).trim();
                posPart = block.substring(idx).trim();
            }

            const subTexts = textPart
                .split(/[;ï¼›ã€]/)
                .map(s => s.trim())
                .filter(Boolean);

            if (subTexts.length === 0) {
                results.push({ text: textPart, pos: posPart });
            } else {
                subTexts.forEach(t => {
                    results.push({ text: t, pos: posPart });
                });
            }
        });

        return results;
    }

    function renderPracticeOptions() {
        refreshTags();
        const select = document.getElementById('practice-scope');
        select.innerHTML = '<option value="all">å…¨éƒ¨å–®å­—å¤¾</option>';
        state.unitTags.forEach(tag => select.innerHTML += `<option value="${tag}">${tag}</option>`);
    }

    function renderPracticeWordSelection() {
        const scope = document.getElementById('practice-scope').value;
        const container = document.getElementById('practice-word-selection');
        const countLabel = document.getElementById('selection-count');
        container.innerHTML = '';

        let pool = (scope === 'all')
            ? [...state.words]
            : state.words.filter(w => w.tags && w.tags.includes(scope));

        pool.sort((a,b) => a.english.localeCompare(b.english));

        if(pool.length === 0) {
            container.innerHTML = '<div class="text-gray-400 text-center py-4">æ­¤è³‡æ–™å¤¾æ²’æœ‰å–®å­—</div>';
            countLabel.innerText = 'å·²é¸ 0 å€‹å–®å­—';
            return;
        }

        pool.forEach((word) => {
            const div = document.createElement('div');
            div.className = "flex items-center p-2 border-b border-gray-100 last:border-0 hover:bgç™½ transition";
            div.innerHTML = `
                <input type="checkbox" class="practice-checkbox w-5 h-5 text-indigo-600 rounded mr-3" checked data-english="${word.english}">
                <div class="flex-1 min-w-0">
                    <div class="font-bold text-gray-800 truncate">${word.english}</div>
                    <div class="text-xs text-gray-500 truncate">${word.meaning}</div>
                </div>
            `;
            container.appendChild(div);
        });
        updateSelectionCount();
        document.querySelectorAll('.practice-checkbox').forEach(cb => cb.addEventListener('change', updateSelectionCount));
    }

    function updateSelectionCount() {
        const checkboxes = document.querySelectorAll('.practice-checkbox:checked');
        document.getElementById('selection-count').innerText = `å·²é¸ ${checkboxes.length} å€‹å–®å­—`;
    }

    function toggleAllPracticeWords(checked) {
        document.querySelectorAll('.practice-checkbox').forEach(cb => cb.checked = checked);
        updateSelectionCount();
    }

    function startGame(mode) {
        const checkboxes = document.querySelectorAll('.practice-checkbox:checked');
        const selectedEnglishes = Array.from(checkboxes).map(cb => cb.dataset.english);
        let pool = state.words.filter(w => selectedEnglishes.includes(w.english));

        if (pool.length === 0) return alert("è«‹è‡³å°‘å‹¾é¸ä¸€å€‹å–®å­—ï¼");

        if (mode.startsWith('choice') && pool.length < 5) {
            if (state.words.length >= 5) alert("å‹¾é¸å–®å­—ä¸è¶³ 5 å€‹ï¼Œå¹²æ“¾é¸é …å°‡ä¾†è‡ªå…¶ä»–å–®å…ƒã€‚");
            else return alert("ç³»çµ±å–®å­—ç¸½é‡ä¸è¶³ 5 å€‹ï¼Œç„¡æ³•é€²è¡Œé¸æ“‡é¡Œï¼");
        }

        state.game.mode = mode;
        state.game.currentWords = pool.sort(() => Math.random() - 0.5);
        state.game.index = 0;
        state.game.wrongWords = new Set();

        if (mode === 'spelling') { showView('game-spelling'); }
        else { showView('game-choice'); }

        if (mode === 'spelling') loadSpellingWord();
        else loadChoiceQuestion();
    }

    function quitGameAndSave() { endGame(true); }
    function quitGame() { navigateTo('practice'); }

    function loadSpellingWord() {
        const word = state.game.currentWords[state.game.index];
        const total = state.game.currentWords.length;
        document.getElementById('spelling-progress-text').innerText = `${state.game.index + 1} / ${total}`;
        document.getElementById('spelling-progress-bar').style.width = `${((state.game.index+1)/total)*100}%`;

        const defArea = document.getElementById('spelling-definition-area');
        defArea.innerHTML = parseMeaning(word.meaning).map(p => `
            <div class="flex flex-col items-center mb-3">
                <div class="text-2xl font-extrabold text-gray-800 text-center">${p.text}</div>
                <div class="mt-1 px-4 py-1 bg-indigo-50 text-indigo-500 rounded-full text-sm font-bold border border-indigo-100">${p.pos||"(?)"}</div>
            </div>`).join('');

        const eng = word.english;
        let hint = eng.length > 2 ? eng[0] + "_".repeat(eng.length-2) + eng[eng.length-1] : eng[0] + "_".repeat(eng.length-1);
        document.getElementById('spelling-hint').innerText = hint.split('').join(' ');
        document.getElementById('spelling-input').value = '';
        document.getElementById('spelling-feedback').innerText = '';
    }

    function checkSpellingAnswer() {
        const input = document.getElementById('spelling-input');
        const correct = state.game.currentWords[state.game.index].english.toLowerCase();
        if (input.value.trim().toLowerCase() === correct) {
            document.getElementById('spelling-feedback').className = "mt-4 text-green-500 font-bold";
            document.getElementById('spelling-feedback').innerText = "æ­£ç¢ºï¼âœ¨";
            setTimeout(nextQuestion, 600);
        } else handleWrongAnswer(input.parentElement);
    }

    function skipSpellingWord() {
        const word = state.game.currentWords[state.game.index];
        state.game.wrongWords.add(word);
        document.getElementById('spelling-input').value = word.english;
        document.getElementById('spelling-feedback').className = "mt-4 text-orange-500 font-bold";
        document.getElementById('spelling-feedback').innerText = `ç­”æ¡ˆï¼š${word.english}`;
        setTimeout(nextQuestion, 1500);
    }

    function loadChoiceQuestion() {
        const word = state.game.currentWords[state.game.index];
        const total = state.game.currentWords.length;
        document.getElementById('choice-progress-text').innerText = `${state.game.index + 1} / ${total}`;
        document.getElementById('choice-progress-bar').style.width = `${((state.game.index+1)/total)*100}%`;
        document.getElementById('choice-feedback').innerText = '';

        const isEnToCh = state.game.mode === 'choice-en-ch';
        const questionEl = document.getElementById('choice-question');
        questionEl.innerText = isEnToCh ? word.english : formatMeaning(word.meaning);

        let options = [word];
        let pool = state.game.currentWords.length >= 5 ? state.game.currentWords : state.words;

        while (options.length < 5) {
            const randomWord = pool[Math.floor(Math.random() * pool.length)];
            if (!options.includes(randomWord)) options.push(randomWord);
        }
        options.sort(() => Math.random() - 0.5);

        const optionsContainer = document.getElementById('choice-options');
        optionsContainer.innerHTML = '';

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "choice-btn w-full bg-white border-2 border-indigo-100 text-gray-700 font-bold py-4 rounded-xl text-lg shadow-sm hover:border-indigo-300";
            btn.innerText = isEnToCh ? formatMeaning(opt.meaning) : opt.english;

            btn.onclick = () => {
                const allBtns = document.querySelectorAll('.choice-btn');
                allBtns.forEach(b => b.disabled = true);

                if (opt === word) {
                    btn.classList.add('choice-correct');
                    document.getElementById('choice-feedback').className = "mt-4 text-green-500 font-bold";
                    document.getElementById('choice-feedback').innerText = "ç­”å°å›‰ï¼ğŸ‰";
                    setTimeout(nextQuestion, 800);
                } else {
                    btn.classList.add('choice-wrong');
                    allBtns.forEach(b => {
                        if ((isEnToCh && b.innerText === formatMeaning(word.meaning)) ||
                            (!isEnToCh && b.innerText === word.english)) {
                            b.classList.add('choice-correct');
                        }
                    });
                    state.game.wrongWords.add(word);
                    document.getElementById('choice-feedback').className = "mt-4 text-red-500 font-bold";
                    document.getElementById('choice-feedback').innerText = "ç­”éŒ¯å›‰ï¼";
                    setTimeout(nextQuestion, 1500);
                }
            };
            optionsContainer.appendChild(btn);
        });
    }

    function formatMeaning(raw) {
        const firstBlock = raw.split('/')[0].trim();
        const idx = firstBlock.lastIndexOf('(');

        let text = firstBlock;
        let pos = '';

        if (idx !== -1) {
            text = firstBlock.substring(0, idx).trim();
            pos = firstBlock.substring(idx).trim();
        }

        const shortText = text.length > 15 ? text.substring(0, 15) + "..." : text;

        return pos ? `${shortText} ${pos}` : shortText;
    }

    function handleWrongAnswer(element) {
        const fbId = state.game.mode.startsWith('choice') ? 'choice-feedback' : 'spelling-feedback';
        document.getElementById(fbId).className = "mt-4 text-red-500 font-bold";
        document.getElementById(fbId).innerText = "æ‹¼éŒ¯å›‰ï¼";
        element.classList.add('shake');
        setTimeout(() => element.classList.remove('shake'), 400);
        state.game.wrongWords.add(state.game.currentWords[state.game.index]);
    }

    function nextQuestion() {
        state.game.index++;
        if (state.game.index < state.game.currentWords.length) {
            if (state.game.mode === 'spelling') loadSpellingWord();
            else loadChoiceQuestion();
        } else {
            endGame(false);
        }
    }

    function endGame(isAborted = false) {
        document.getElementById('view-game-spelling').classList.add('hidden');
        document.getElementById('view-game-choice').classList.add('hidden');
        document.getElementById('view-game-result').classList.remove('hidden');

        const list = document.getElementById('result-skipped-items');
        const stat = document.getElementById('result-stat');
        const title = document.getElementById('result-title');
        const icon = document.getElementById('result-icon');

        if (isAborted) {
            title.innerText = "ç·´ç¿’ä¸­æ–·";
            icon.innerText = "â¸ï¸";
        } else {
            title.innerText = "ç·´ç¿’å®Œæˆï¼";
            icon.innerText = "ğŸ‰";
        }

        const wrongs = Array.from(state.game.wrongWords);
        stat.innerText = `ç­”éŒ¯/è·³é: ${wrongs.length} é¡Œ`;
        state.game.reviewSelection = [];

        if (wrongs.length === 0) {
            list.innerHTML = `<li class="p-4 text-center text-green-600 font-bold bg-green-50 rounded-xl">ğŸ‘ å®Œç¾ï¼æ²’æœ‰éŒ¯èª¤å–®å­—ã€‚</li>`;
        } else {
            list.innerHTML = wrongs.map((w, idx) => {
                state.game.reviewSelection.push(w);
                const isAlreadyWrong = w.tags && w.tags.includes("éŒ¯é¡Œå€");
                return `
                <li class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3">
                    <input type="checkbox" id="review-chk-${idx}" class="w-6 h-6 text-indigo-600 rounded flex-none" checked onchange="toggleReviewItem(${idx})">
                    <div class="flex flex-col flex-1 min-w-0">
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="text-indigo-600 font-black text-lg break-all">${w.english}</span>
                            ${isAlreadyWrong ? '<span class="text-xs bg-red-100 text-red-500 px-1 rounded-flex-none">å·²åœ¨éŒ¯é¡Œå€</span>' : ''}
                        </div>
                        <span class="text-gray-500 text-sm truncate">${w.meaning}</span>
                    </div>
                </li>
            `}).join('');
        }

        const saveSelect = document.getElementById('save-target-folder');
        saveSelect.innerHTML = '<option value="NEW_FOLDER_OPTION" class="text-indigo-600 font-bold">+ æ–°å¢è³‡æ–™å¤¾...</option>';
        state.unitTags.forEach(tag => {
            const isWrong = tag === "éŒ¯é¡Œå€";
            saveSelect.innerHTML += `<option value="${tag}" ${isWrong ? 'selected' : ''}>${tag}</option>`;
        });
    }

    window.toggleReviewItem = function(idx) {
        const wrongs = Array.from(state.game.wrongWords);
        const word = wrongs[idx];
        const checkbox = document.getElementById(`review-chk-${idx}`);
        if (checkbox.checked) {
            if(!state.game.reviewSelection.includes(word)) state.game.reviewSelection.push(word);
        } else {
            state.game.reviewSelection = state.game.reviewSelection.filter(w => w !== word);
        }
    };

    function saveWrongWords() {
        if (state.game.reviewSelection.length === 0) return alert("æœªé¸æ“‡ä»»ä½•å–®å­—");

        let targetFolder = document.getElementById('save-target-folder').value;

        if (targetFolder === 'NEW_FOLDER_OPTION') {
            const newName = prompt("è«‹è¼¸å…¥æ–°è³‡æ–™å¤¾åç¨±ï¼š");
            if (!newName || !newName.trim()) return;
            targetFolder = newName.trim();

            if (!state.folders.includes(targetFolder)) {
                state.folders.push(targetFolder);
            }
        }

        let count = 0;
        state.game.reviewSelection.forEach(word => {
            if (!word.tags) word.tags = [];
            if (!word.tags.includes(targetFolder)) {
                word.tags.push(targetFolder);
                count++;
            }
        });

        saveDataLocally();
        alert(`å·²å°‡ ${count} å€‹å–®å­—åŠ å…¥ã€Œ${targetFolder}ã€ï¼`);
        navigateTo('practice');
    }

    // è¨­å®š Modal ç›¸é—œ
    window.openSettingsModal = function() {
        const modal = document.getElementById('settings-modal');
        if (!modal) return;

        const bgmEnabledEl = document.getElementById('settings-bgm-enabled');
        const bgmVolumeEl = document.getElementById('settings-bgm-volume');
        const bgmVolumeLabel = document.getElementById('settings-bgm-volume-value');
        const speechVolumeEl = document.getElementById('settings-speech-volume');
        const speechVolumeLabel = document.getElementById('settings-speech-volume-value');
        const bgmSelectEl = document.getElementById('settings-bgm-select');

        if (bgmSelectEl && !bgmSelectEl.options.length) {
            BGM_TRACKS.forEach(track => {
                const opt = document.createElement('option');
                opt.value = track.id;
                opt.textContent = track.name;
                bgmSelectEl.appendChild(opt);
            });
        }

        if (bgmEnabledEl) bgmEnabledEl.checked = !!state.settings.bgmEnabled;

        if (bgmVolumeEl) {
            const v = Math.round(clamp01(state.settings.bgmVolume) * 100);
            bgmVolumeEl.value = v;
            if (bgmVolumeLabel) bgmVolumeLabel.textContent = v + '%';
        }

        if (speechVolumeEl) {
            const v = Math.round(clamp01(state.settings.speechVolume) * 100);
            speechVolumeEl.value = v;
            if (speechVolumeLabel) speechVolumeLabel.textContent = v + '%';
        }

        if (bgmSelectEl) {
            bgmSelectEl.value = state.settings.selectedBgmId;
        }

        modal.classList.remove('hidden');
    };

    window.closeSettingsModal = function() {
        const modal = document.getElementById('settings-modal');
        if (modal) modal.classList.add('hidden');
        saveSettingsFromUI();
    };

    function saveSettingsFromUI() {
        const bgmEnabledEl = document.getElementById('settings-bgm-enabled');
        const bgmVolumeEl = document.getElementById('settings-bgm-volume');
        const speechVolumeEl = document.getElementById('settings-speech-volume');
        const bgmSelectEl = document.getElementById('settings-bgm-select');

        if (bgmEnabledEl) state.settings.bgmEnabled = !!bgmEnabledEl.checked;
        if (bgmVolumeEl) state.settings.bgmVolume = clamp01((parseInt(bgmVolumeEl.value, 10) || 0) / 100);
        if (speechVolumeEl) state.settings.speechVolume = clamp01((parseInt(speechVolumeEl.value, 10) || 0) / 100);
        if (bgmSelectEl && bgmSelectEl.value) state.settings.selectedBgmId = bgmSelectEl.value;

        applyBgmSettingsToElement();
        saveDataLocally();
    }

    window.updateBgmVolumeFromSlider = function(value) {
        const v = Math.max(0, Math.min(100, parseInt(value, 10) || 0));
        const label = document.getElementById('settings-bgm-volume-value');
        if (label) label.textContent = v + '%';
        state.settings.bgmVolume = clamp01(v / 100);

        if (state.audio && state.audio.bgmElement) {
            const audio = state.audio.bgmElement;
            if (bgmDucking.isDucking) {
                audio.volume = clamp01(state.settings.bgmVolume * bgmDucking.ratio);
            } else {
                audio.volume = clamp01(state.settings.bgmVolume);
            }
        }
    };

    window.updateSpeechVolumeFromSlider = function(value) {
        const v = Math.max(0, Math.min(100, parseInt(value, 10) || 0));
        const label = document.getElementById('settings-speech-volume-value');
        if (label) label.textContent = v + '%';
        state.settings.speechVolume = clamp01(v / 100);
    };

    window.toggleBgmEnabledFromCheckbox = function(checked) {
        state.settings.bgmEnabled = !!checked;
        applyBgmSettingsToElement();
        saveDataLocally();
    };

    window.changeBgmTrackFromSelect = function(trackId) {
        state.settings.selectedBgmId = trackId;
        if (!state.audio || !state.audio.bgmElement) return;
        const audio = state.audio.bgmElement;
        const track = getCurrentBgmTrack();
        if (track) {
            const wasPlaying = !audio.paused;
            audio.src = track.url;
            if (state.settings.bgmEnabled && wasPlaying) {
                audio.play().catch(() => {});
            }
        }
        saveDataLocally();
    };

    window.onload = () => {
        initSystem();
        setupAudioSystem(); // åˆå§‹åŒ–èƒŒæ™¯éŸ³æ¨‚ï¼ˆä¾è¨­å®šæ±ºå®šæ˜¯å¦æ’­æ”¾ï¼‰
        setupBgmAutoplayUnlock(); // ç”±ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡äº’å‹•è§£é–è‡ªå‹•æ’­æ”¾é™åˆ¶

        const params = new URL(window.location).searchParams;
        const page = params.get('page') || 'home';
        showView(page);
        try {
            history.replaceState({ viewId: page }, '', window.location);
        } catch (e) {
            console.log("History API not supported or restricted:", e);
        }
    };
</script>

<!-- Firebase + Firestore + Auth æ¨¡çµ„è…³æœ¬ -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import {
        getAuth,
        onAuthStateChanged,
        GoogleAuthProvider,
        signInWithPopup,
        signOut
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import {
        getFirestore,
        doc,
        getDoc,
        setDoc
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB2Q10x0JxoAGQt4IiwGr9rwyIm7M1xjbA",
        authDomain: "wordking-434f7.firebaseapp.com",
        projectId: "wordking-434f7",
        storageBucket: "wordking-434f7.firebasestorage.app",
        messagingSenderId: "340952543206",
        appId: "1:340952543206:web:5388cff593ebee0d61b027"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    function updateAuthUI(user) {
        const loginBtn = document.getElementById('btn-login');
        const logoutBtn = document.getElementById('btn-logout');
        const syncBtn = document.getElementById('btn-sync');
        const userSpan = document.getElementById('user-email');

        if (!loginBtn || !logoutBtn || !syncBtn || !userSpan) return;

        if (user) {
            loginBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden');
            syncBtn.classList.remove('hidden');
            userSpan.classList.remove('hidden');
            userSpan.textContent = user.email || user.displayName || 'å·²ç™»å…¥';
        } else {
            loginBtn.classList.remove('hidden');
            logoutBtn.classList.add('hidden');
            syncBtn.classList.add('hidden');
            userSpan.classList.add('hidden');
            userSpan.textContent = '';
        }
    }

    function mergeWords(baseWords, cloudWords) {
        const map = new Map();

        (baseWords || []).forEach(w => {
            if (w && w.english) {
                map.set(w.english.toLowerCase(), { ...w });
            }
        });

        (cloudWords || []).forEach(w => {
            if (!w || !w.english) return;
            const key = w.english.toLowerCase();
            if (map.has(key)) {
                const base = map.get(key);
                const baseTags = Array.isArray(base.tags) ? base.tags : [];
                const cloudTags = Array.isArray(w.tags) ? w.tags : [];
                const mergedTags = Array.from(new Set([...baseTags, ...cloudTags]));

                map.set(key, {
                    ...base,
                    tags: mergedTags
                });
            } else {
                map.set(key, { ...w });
            }
        });

        return Array.from(map.values());
    }

    async function saveToCloud(user) {
        if (!window.state) return;

        const payload = {
            words: window.state.words || [],
            folders: window.state.folders || [],
            settings: window.state.settings || undefined
        };

        const ref = doc(db, 'users', user.uid);
        await setDoc(ref, payload, { merge: true });
    }

    async function loadFromCloud(user) {
        const ref = doc(db, 'users', user.uid);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
            await saveToCloud(user);
            return;
        }

        const data = snap.data();
        const cloudWords = data.words || [];
        const cloudFolders = data.folders || [];
        const cloudSettings = data.settings || null;

        const baseWords =
            (Array.isArray(window.defaultWordDatabase) && window.defaultWordDatabase.length > 0)
                ? window.defaultWordDatabase
                : (window.state?.words || []);

        const mergedWords = mergeWords(baseWords, cloudWords);

        if (window.state) {
            window.state.words = mergedWords;
            window.state.folders = Array.from(new Set(["éŒ¯é¡Œå€", ...(cloudFolders || [])]));

            if (cloudSettings && typeof window.hydrateSettings === 'function') {
                window.state.settings = window.hydrateSettings(cloudSettings);
            }

            if (typeof window.saveDataLocally === 'function') {
                window.saveDataLocally();
            }

            if (typeof window.refreshTags === 'function') {
                window.refreshTags();
            }

            if (typeof window.applyBgmSettingsToElement === 'function') {
                window.applyBgmSettingsToElement();
            }

            const libView = document.getElementById('view-library');
            const pracView = document.getElementById('view-practice');

            if (libView && !libView.classList.contains('hidden') && typeof window.renderLibrary === 'function') {
                window.renderLibrary();
            }
            if (pracView && !pracView.classList.contains('hidden')
                && typeof window.renderPracticeOptions === 'function'
                && typeof window.renderPracticeWordSelection === 'function') {
                window.renderPracticeOptions();
                window.renderPracticeWordSelection();
            }
        }
    }

    window.firebaseLogin = async () => {
        try {
            await signInWithPopup(auth, provider);
        } catch (err) {
            console.error(err);
            alert('ç™»å…¥å¤±æ•—ï¼š' + (err.message || err));
        }
    };

    window.firebaseLogout = async () => {
        try {
            await signOut(auth);
        } catch (err) {
            console.error(err);
            alert('ç™»å‡ºå¤±æ•—ï¼š' + (err.message || err));
        }
    };

    window.syncCloudNow = async () => {
        const user = auth.currentUser;
        if (!user) {
            alert('è«‹å…ˆç™»å…¥');
            return;
        }
        try {
            await saveToCloud(user);
            alert('å·²å°‡ç›®å‰è³‡æ–™åŒæ­¥åˆ°é›²ç«¯');
        } catch (err) {
            console.error(err);
            alert('åŒæ­¥å¤±æ•—ï¼š' + (err.message || err));
        }
    };

    window.autoSyncToCloud = async () => {
        const user = auth.currentUser;
        if (!user) return;
        try {
            await saveToCloud(user);
        } catch (err) {
            console.error('è‡ªå‹•åŒæ­¥å¤±æ•—', err);
        }
    };

    onAuthStateChanged(auth, async user => {
        updateAuthUI(user);
        if (user) {
            try {
                await loadFromCloud(user);
                console.log('å·²å¾é›²ç«¯è¼‰å…¥å€‹äººè³‡æ–™');
            } catch (err) {
                console.error('è¼‰å…¥é›²ç«¯è³‡æ–™å¤±æ•—', err);
            }
        }
    });
</script>

<div id="root" style="display: none;"></div>
</body>
</html>
